2021-10-28 16:25:04.439893 (MainThread): Running with dbt=0.21.0
2021-10-28 16:25:04.747308 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:25:04.748489 (MainThread): Tracking: tracking
2021-10-28 16:25:04.758853 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca38370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea24ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea24b20>]}
2021-10-28 16:25:04.770746 (MainThread): Partial parsing not enabled
2021-10-28 16:25:04.792384 (MainThread): Parsing macros/etc.sql
2021-10-28 16:25:04.796892 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:25:04.803044 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:25:04.825463 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:25:04.828099 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:25:04.830647 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:25:04.839823 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:25:04.842378 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:25:04.856497 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:25:04.858299 (MainThread): Parsing macros/core.sql
2021-10-28 16:25:04.862348 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:25:04.868944 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:25:04.878413 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:25:04.880222 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:25:04.896866 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:25:04.928713 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:25:04.950829 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:25:04.952532 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:25:04.962404 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:25:04.981866 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:25:04.995551 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:25:05.003690 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:25:05.010502 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:25:05.013971 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:25:05.015293 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:25:05.016150 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:25:05.017505 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:25:05.025638 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:25:05.027294 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:25:05.029659 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:25:05.031101 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:25:05.084980 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:25:05.086580 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:25:05.087680 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:25:05.088900 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:25:05.281693 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:25:05.293653 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:25:05.319734 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:25:05.321485 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:25:05.323219 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:25:05.325061 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:25:05.339674 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e45a346c-60fb-451a-b6e2-491c46ae0a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eba1f70>]}
2021-10-28 16:25:05.344328 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:25:05.344680 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e45a346c-60fb-451a-b6e2-491c46ae0a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eba1d60>]}
2021-10-28 16:25:05.344944 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:25:05.346353 (MainThread): 
2021-10-28 16:25:05.346752 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:25:05.347613 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:25:05.347854 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:25:05.348019 (ThreadPoolExecutor-0_0): Got an error when attempting to create a bigquery client: 'expected str, bytes or os.PathLike object, not NoneType'
2021-10-28 16:25:05.348922 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:25:05.349038 (MainThread): Connection 'list_ft-data-330317' was properly closed.
2021-10-28 16:25:05.349153 (MainThread): ERROR: Database Error
  expected str, bytes or os.PathLike object, not NoneType
2021-10-28 16:25:05.349349 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eac6f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eba1190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eba14c0>]}
2021-10-28 16:25:05.349592 (MainThread): Flushing usage events
2021-10-28 16:28:01.124246 (MainThread): Running with dbt=0.21.0
2021-10-28 16:28:01.418464 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:28:01.419858 (MainThread): Tracking: tracking
2021-10-28 16:28:01.429676 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fba9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fdb250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fdb1c0>]}
2021-10-28 16:28:01.440554 (MainThread): Partial parsing not enabled
2021-10-28 16:28:01.451699 (MainThread): Parsing macros/etc.sql
2021-10-28 16:28:01.454524 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:28:01.460822 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:28:01.482834 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:28:01.485197 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:28:01.487652 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:28:01.496411 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:28:01.498930 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:28:01.512223 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:28:01.513711 (MainThread): Parsing macros/core.sql
2021-10-28 16:28:01.517087 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:28:01.523839 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:28:01.534743 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:28:01.536576 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:28:01.553091 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:28:01.584402 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:28:01.605822 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:28:01.607395 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:28:01.617126 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:28:01.635925 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:28:01.649080 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:28:01.656733 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:28:01.663468 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:28:01.667167 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:28:01.668507 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:28:01.669365 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:28:01.670837 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:28:01.678749 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:28:01.680363 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:28:01.682550 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:28:01.684067 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:28:01.736319 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:28:01.737877 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:28:01.738951 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:28:01.740166 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:28:01.928896 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:28:01.940601 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:28:01.965641 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:28:01.967408 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:28:01.969133 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:28:01.970884 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:28:01.984520 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7eaa4841-45eb-4558-bd8f-a62e5215d80c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11304a040>]}
2021-10-28 16:28:01.989050 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:28:01.989436 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7eaa4841-45eb-4558-bd8f-a62e5215d80c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113065460>]}
2021-10-28 16:28:01.989698 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:28:01.991126 (MainThread): 
2021-10-28 16:28:01.991510 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:28:01.992335 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:28:01.992528 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:28:02.801397 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:28:02.802056 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:28:02.814493 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:28:03.435021 (MainThread): 17:28:03 | Concurrency: 4 threads (target='dev')
2021-10-28 16:28:03.435542 (MainThread): 17:28:03 | 
2021-10-28 16:28:03.450990 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:28:03.451491 (Thread-1): 17:28:03 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:28:03.452039 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:28:03.452281 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:28:03.455770 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:28:03.456621 (Thread-1): finished collecting timing info
2021-10-28 16:28:03.494745 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:28:03.495565 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:28:03.500944 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:28:06.052890 (Thread-1): finished collecting timing info
2021-10-28 16:28:06.053565 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7eaa4841-45eb-4558-bd8f-a62e5215d80c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131b2730>]}
2021-10-28 16:28:06.054084 (Thread-1): 17:28:06 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (2.0 rows, 0.0 Bytes processed) in 2.60s]
2021-10-28 16:28:06.054337 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:28:06.054969 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:28:06.055341 (Thread-3): 17:28:06 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:28:06.055819 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:28:06.056043 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:28:06.057601 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61659), raddr=('216.58.215.170', 443)>
2021-10-28 16:28:06.058216 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61660), raddr=('216.58.215.170', 443)>
2021-10-28 16:28:06.058489 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61661), raddr=('216.58.215.170', 443)>
2021-10-28 16:28:06.058731 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61662), raddr=('216.58.215.170', 443)>
2021-10-28 16:28:06.061560 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:28:06.062121 (Thread-3): finished collecting timing info
2021-10-28 16:28:06.085972 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:28:06.086542 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:28:06.092236 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where id = 1;


2021-10-28 16:28:07.583840 (Thread-3): finished collecting timing info
2021-10-28 16:28:07.584594 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7eaa4841-45eb-4558-bd8f-a62e5215d80c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11429d370>]}
2021-10-28 16:28:07.585170 (Thread-3): 17:28:07 | 2 of 2 OK created view model ft_data.my_second_dbt_model............. [OK in 1.53s]
2021-10-28 16:28:07.585461 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:28:07.587355 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:28:07.587929 (MainThread): 17:28:07 | 
2021-10-28 16:28:07.588207 (MainThread): 17:28:07 | Finished running 1 table model, 1 view model in 5.60s.
2021-10-28 16:28:07.588447 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:28:07.588642 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:28:07.588825 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:28:07.590781 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61665), raddr=('216.58.215.170', 443)>
2021-10-28 16:28:07.591054 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61666), raddr=('216.58.215.170', 443)>
2021-10-28 16:28:07.596517 (MainThread): 
2021-10-28 16:28:07.596757 (MainThread): Completed successfully
2021-10-28 16:28:07.596935 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:28:07.597189 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130ca940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113183700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113183190>]}
2021-10-28 16:28:07.597451 (MainThread): Flushing usage events
2021-10-28 16:30:15.296684 (MainThread): Running with dbt=0.21.0
2021-10-28 16:30:15.594039 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:30:15.595148 (MainThread): Tracking: tracking
2021-10-28 16:30:15.606065 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11179a760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117bdfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117bd370>]}
2021-10-28 16:30:15.617221 (MainThread): Partial parsing not enabled
2021-10-28 16:30:15.628329 (MainThread): Parsing macros/etc.sql
2021-10-28 16:30:15.631200 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:30:15.637573 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:30:15.659885 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:30:15.662271 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:30:15.664638 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:30:15.673572 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:30:15.675980 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:30:15.689416 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:30:15.690920 (MainThread): Parsing macros/core.sql
2021-10-28 16:30:15.694365 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:30:15.701550 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:30:15.711231 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:30:15.713383 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:30:15.730321 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:30:15.761949 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:30:15.783361 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:30:15.785009 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:30:15.794585 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:30:15.813497 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:30:15.826563 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:30:15.834177 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:30:15.841262 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:30:15.844855 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:30:15.846184 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:30:15.847043 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:30:15.848400 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:30:15.856278 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:30:15.857882 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:30:15.860157 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:30:15.861571 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:30:15.913505 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:30:15.915022 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:30:15.916176 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:30:15.917388 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:30:16.106197 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:30:16.117611 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:30:16.142925 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:30:16.144649 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:30:16.146370 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:30:16.147987 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:30:16.161457 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5775c0e6-c3e4-4978-b96a-1461722af859', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11183bee0>]}
2021-10-28 16:30:16.166000 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:30:16.166433 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5775c0e6-c3e4-4978-b96a-1461722af859', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11183bac0>]}
2021-10-28 16:30:16.166746 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:30:16.168274 (MainThread): 
2021-10-28 16:30:16.168738 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:30:16.169560 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:30:16.169758 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:30:16.943195 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:30:16.943826 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:30:16.955842 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:30:17.420606 (MainThread): 17:30:17 | Concurrency: 4 threads (target='dev')
2021-10-28 16:30:17.420884 (MainThread): 17:30:17 | 
2021-10-28 16:30:17.423325 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:30:17.423661 (Thread-1): 17:30:17 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:30:17.424042 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:30:17.424218 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:30:17.426924 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:30:17.427424 (Thread-1): finished collecting timing info
2021-10-28 16:30:17.446563 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:30:17.451824 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:30:17.991859 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:30:17.992470 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:30:20.327312 (Thread-1): finished collecting timing info
2021-10-28 16:30:20.327976 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5775c0e6-c3e4-4978-b96a-1461722af859', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118a92e0>]}
2021-10-28 16:30:20.328532 (Thread-1): 17:30:20 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 2.90s]
2021-10-28 16:30:20.328785 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:30:20.329540 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:30:20.329912 (Thread-3): 17:30:20 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:30:20.330454 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:30:20.330701 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:30:20.332265 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61681), raddr=('216.58.215.170', 443)>
2021-10-28 16:30:20.332633 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61682), raddr=('216.58.215.170', 443)>
2021-10-28 16:30:20.332885 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61683), raddr=('216.58.215.170', 443)>
2021-10-28 16:30:20.333114 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61684), raddr=('216.58.215.170', 443)>
2021-10-28 16:30:20.335777 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:30:20.336304 (Thread-3): finished collecting timing info
2021-10-28 16:30:20.359996 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:30:20.360563 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:30:20.366273 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where id = 1;


2021-10-28 16:30:21.297962 (Thread-3): Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: id at [10:7]')
2021-10-28 16:30:22.258320 (Thread-3): finished collecting timing info
2021-10-28 16:30:22.259355 (Thread-3): Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Unrecognized name: id at [10:7]
  compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Unrecognized name: id at [10:7]

(job ID: 3e4a3ea8-7340-4420-b0de-6dd406855671)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */
   2:
   3:
   4:  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
   5:  OPTIONS()
   6:  as -- Use the `ref` function to select from other models
   7:
   8:select *
   9:from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  10:where id = 1;
  11:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 167, in exception_handler
    self.handle_error(e, message)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 155, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Unrecognized name: id at [10:7]
  compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
2021-10-28 16:30:22.287486 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5775c0e6-c3e4-4978-b96a-1461722af859', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a77eb0>]}
2021-10-28 16:30:22.288343 (Thread-3): 17:30:22 | 2 of 2 ERROR creating view model ft_data.my_second_dbt_model......... [ERROR in 1.96s]
2021-10-28 16:30:22.288782 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:30:22.291000 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:30:22.291588 (MainThread): 17:30:22 | 
2021-10-28 16:30:22.291866 (MainThread): 17:30:22 | Finished running 1 table model, 1 view model in 6.12s.
2021-10-28 16:30:22.292111 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:30:22.292307 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:30:22.292494 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:30:22.300416 (MainThread): 
2021-10-28 16:30:22.300703 (MainThread): Completed with 1 error and 0 warnings:
2021-10-28 16:30:22.300922 (MainThread): 
2021-10-28 16:30:22.301134 (MainThread): Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
2021-10-28 16:30:22.301330 (MainThread):   Unrecognized name: id at [10:7]
2021-10-28 16:30:22.301520 (MainThread):   compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
2021-10-28 16:30:22.301716 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-10-28 16:30:22.302029 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11183b7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111848d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111848d00>]}
2021-10-28 16:30:22.302285 (MainThread): Flushing usage events
2021-10-28 16:32:05.572226 (MainThread): Running with dbt=0.21.0
2021-10-28 16:32:05.876828 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:32:05.877810 (MainThread): Tracking: tracking
2021-10-28 16:32:05.888226 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9e23a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111997dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119970d0>]}
2021-10-28 16:32:05.899339 (MainThread): Partial parsing not enabled
2021-10-28 16:32:05.910576 (MainThread): Parsing macros/etc.sql
2021-10-28 16:32:05.913460 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:32:05.919579 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:32:05.941828 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:32:05.944287 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:32:05.946769 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:32:05.955744 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:32:05.958184 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:32:05.971843 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:32:05.973471 (MainThread): Parsing macros/core.sql
2021-10-28 16:32:05.976919 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:32:05.984014 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:32:05.994261 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:32:05.996448 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:32:06.013024 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:32:06.044220 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:32:06.066085 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:32:06.067823 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:32:06.077384 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:32:06.097461 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:32:06.110862 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:32:06.118879 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:32:06.125886 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:32:06.129433 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:32:06.130843 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:32:06.131702 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:32:06.133066 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:32:06.141035 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:32:06.142719 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:32:06.144909 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:32:06.146338 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:32:06.198838 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:32:06.200367 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:32:06.201481 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:32:06.202690 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:32:06.391425 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:32:06.402914 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:32:06.427993 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:32:06.429729 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:32:06.431548 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:32:06.433125 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:32:06.446996 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e3e83be3-ecbc-4377-8f9b-ea196f158696', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c8afa0>]}
2021-10-28 16:32:06.451756 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:32:06.452157 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e3e83be3-ecbc-4377-8f9b-ea196f158696', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c8afa0>]}
2021-10-28 16:32:06.452416 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:32:06.453926 (MainThread): 
2021-10-28 16:32:06.454338 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:32:06.455210 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:32:06.455375 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:32:07.226124 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:32:07.226762 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:32:07.238909 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:32:07.840549 (MainThread): 17:32:07 | Concurrency: 4 threads (target='dev')
2021-10-28 16:32:07.841078 (MainThread): 17:32:07 | 
2021-10-28 16:32:07.846016 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:32:07.846756 (Thread-1): 17:32:07 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:32:07.847579 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:32:07.847997 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:32:07.852888 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:32:07.853705 (Thread-1): finished collecting timing info
2021-10-28 16:32:07.878992 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:32:07.884828 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:32:08.479901 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:32:08.480524 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:32:10.934876 (Thread-1): finished collecting timing info
2021-10-28 16:32:10.935569 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e83be3-ecbc-4377-8f9b-ea196f158696', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bbd0d0>]}
2021-10-28 16:32:10.936108 (Thread-1): 17:32:10 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 3.09s]
2021-10-28 16:32:10.936369 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:32:10.937144 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:32:10.937525 (Thread-3): 17:32:10 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:32:10.938131 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:32:10.938384 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:32:10.939973 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61703), raddr=('142.250.184.10', 443)>
2021-10-28 16:32:10.940275 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61704), raddr=('216.58.215.170', 443)>
2021-10-28 16:32:10.940515 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61705), raddr=('142.250.184.10', 443)>
2021-10-28 16:32:10.940745 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61706), raddr=('216.58.215.170', 443)>
2021-10-28 16:32:10.943418 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:32:10.943944 (Thread-3): finished collecting timing info
2021-10-28 16:32:10.967789 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:32:10.968368 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:32:10.974078 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where nationality = aus;


2021-10-28 16:32:12.132682 (Thread-3): Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: aus at [10:21]')
2021-10-28 16:32:13.984448 (Thread-3): finished collecting timing info
2021-10-28 16:32:13.985475 (Thread-3): Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Unrecognized name: aus at [10:21]
  compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Unrecognized name: aus at [10:21]

(job ID: 6b486548-2d7b-4a50-a146-223f5a67edfc)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */
   2:
   3:
   4:  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
   5:  OPTIONS()
   6:  as -- Use the `ref` function to select from other models
   7:
   8:select *
   9:from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  10:where nationality = aus;
  11:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 167, in exception_handler
    self.handle_error(e, message)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 155, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Unrecognized name: aus at [10:21]
  compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
2021-10-28 16:32:13.991510 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e83be3-ecbc-4377-8f9b-ea196f158696', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d3d190>]}
2021-10-28 16:32:13.992121 (Thread-3): 17:32:13 | 2 of 2 ERROR creating view model ft_data.my_second_dbt_model......... [ERROR in 3.05s]
2021-10-28 16:32:13.992436 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:32:13.994275 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:32:13.994800 (MainThread): 17:32:13 | 
2021-10-28 16:32:13.995046 (MainThread): 17:32:13 | Finished running 1 table model, 1 view model in 7.54s.
2021-10-28 16:32:13.995256 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:32:13.995428 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:32:13.995589 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:32:14.002370 (MainThread): 
2021-10-28 16:32:14.002606 (MainThread): Completed with 1 error and 0 warnings:
2021-10-28 16:32:14.002780 (MainThread): 
2021-10-28 16:32:14.002946 (MainThread): Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
2021-10-28 16:32:14.003099 (MainThread):   Unrecognized name: aus at [10:21]
2021-10-28 16:32:14.003241 (MainThread):   compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
2021-10-28 16:32:14.003395 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-10-28 16:32:14.003641 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a462e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a2ea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c51040>]}
2021-10-28 16:32:14.003908 (MainThread): Flushing usage events
2021-10-28 16:42:01.281291 (MainThread): Running with dbt=0.21.0
2021-10-28 16:42:01.584642 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:42:01.585575 (MainThread): Tracking: tracking
2021-10-28 16:42:01.595685 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083cd280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48f0d0>]}
2021-10-28 16:42:01.606706 (MainThread): Partial parsing not enabled
2021-10-28 16:42:01.618082 (MainThread): Parsing macros/etc.sql
2021-10-28 16:42:01.621182 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:42:01.627405 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:42:01.649697 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:42:01.652135 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:42:01.654693 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:42:01.663718 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:42:01.666159 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:42:01.680504 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:42:01.682101 (MainThread): Parsing macros/core.sql
2021-10-28 16:42:01.685600 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:42:01.692623 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:42:01.702649 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:42:01.704273 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:42:01.720984 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:42:01.752591 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:42:01.774490 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:42:01.776072 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:42:01.785398 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:42:01.804097 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:42:01.816981 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:42:01.824637 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:42:01.831297 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:42:01.834896 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:42:01.836229 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:42:01.837113 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:42:01.838526 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:42:01.846283 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:42:01.847939 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:42:01.850104 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:42:01.851513 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:42:01.904437 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:42:01.906094 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:42:01.907166 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:42:01.908377 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:42:02.096650 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:42:02.108174 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:42:02.133578 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:42:02.135282 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:42:02.136990 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:42:02.138609 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:42:02.152820 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d216b1f-b539-4a03-af54-50ba747fd976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a634fa0>]}
2021-10-28 16:42:02.157490 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:42:02.157872 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d216b1f-b539-4a03-af54-50ba747fd976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a634fa0>]}
2021-10-28 16:42:02.158100 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:42:02.159505 (MainThread): 
2021-10-28 16:42:02.159866 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:42:02.160610 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:42:02.160766 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:42:03.014110 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:42:03.014604 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:42:03.025062 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:42:03.652877 (MainThread): 17:42:03 | Concurrency: 4 threads (target='dev')
2021-10-28 16:42:03.653375 (MainThread): 17:42:03 | 
2021-10-28 16:42:03.657372 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:42:03.657887 (Thread-1): 17:42:03 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:42:03.658506 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:42:03.658790 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:42:03.662711 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:42:03.663384 (Thread-1): finished collecting timing info
2021-10-28 16:42:03.685787 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:42:03.691661 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:42:04.301798 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:42:04.302433 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:42:07.334866 (Thread-1): finished collecting timing info
2021-10-28 16:42:07.335550 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d216b1f-b539-4a03-af54-50ba747fd976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a689850>]}
2021-10-28 16:42:07.336077 (Thread-1): 17:42:07 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 3.68s]
2021-10-28 16:42:07.336337 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:42:07.337120 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:42:07.337504 (Thread-3): 17:42:07 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:42:07.338012 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:42:07.338244 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:42:07.339798 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61740), raddr=('142.250.185.10', 443)>
2021-10-28 16:42:07.340225 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61741), raddr=('142.250.184.170', 443)>
2021-10-28 16:42:07.340499 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61743), raddr=('142.250.185.10', 443)>
2021-10-28 16:42:07.340753 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61746), raddr=('142.250.184.170', 443)>
2021-10-28 16:42:07.343518 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:42:07.344069 (Thread-3): finished collecting timing info
2021-10-28 16:42:07.367847 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:42:07.368412 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:42:07.374256 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where nationality = 'aus';


2021-10-28 16:42:09.120152 (Thread-3): finished collecting timing info
2021-10-28 16:42:09.120911 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d216b1f-b539-4a03-af54-50ba747fd976', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a731ac0>]}
2021-10-28 16:42:09.121500 (Thread-3): 17:42:09 | 2 of 2 OK created view model ft_data.my_second_dbt_model............. [OK in 1.78s]
2021-10-28 16:42:09.121800 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:42:09.123568 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:42:09.124169 (MainThread): 17:42:09 | 
2021-10-28 16:42:09.124453 (MainThread): 17:42:09 | Finished running 1 table model, 1 view model in 6.96s.
2021-10-28 16:42:09.124694 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:42:09.124889 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:42:09.125074 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:42:09.127102 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61752), raddr=('142.250.185.10', 443)>
2021-10-28 16:42:09.127377 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61753), raddr=('142.250.184.170', 443)>
2021-10-28 16:42:09.133006 (MainThread): 
2021-10-28 16:42:09.133222 (MainThread): Completed successfully
2021-10-28 16:42:09.133396 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:42:09.133647 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a53b820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a523d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a60b130>]}
2021-10-28 16:42:09.133906 (MainThread): Flushing usage events
2021-10-28 16:44:15.181952 (MainThread): Running with dbt=0.21.0
2021-10-28 16:44:15.480188 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:44:15.481396 (MainThread): Tracking: tracking
2021-10-28 16:44:15.491210 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c185820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c160f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1a75b0>]}
2021-10-28 16:44:15.502218 (MainThread): Partial parsing not enabled
2021-10-28 16:44:15.513475 (MainThread): Parsing macros/etc.sql
2021-10-28 16:44:15.516279 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:44:15.522452 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:44:15.544823 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:44:15.547261 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:44:15.549626 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:44:15.558466 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:44:15.560890 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:44:15.574158 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:44:15.575670 (MainThread): Parsing macros/core.sql
2021-10-28 16:44:15.578994 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:44:15.586290 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:44:15.596051 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:44:15.597716 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:44:15.614695 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:44:15.646395 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:44:15.669222 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:44:15.670992 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:44:15.680818 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:44:15.700912 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:44:15.716196 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:44:15.725372 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:44:15.733399 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:44:15.737328 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:44:15.738723 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:44:15.739656 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:44:15.741077 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:44:15.749074 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:44:15.750727 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:44:15.753019 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:44:15.754482 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:44:15.806587 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:44:15.808125 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:44:15.809209 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:44:15.810425 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:44:15.998430 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:44:16.009907 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:44:16.035157 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:44:16.037153 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:44:16.039524 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:44:16.041574 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:44:16.057293 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3fcbf2f1-392b-4c78-b6e8-79e28ad61215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c273fd0>]}
2021-10-28 16:44:16.061738 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:44:16.062106 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3fcbf2f1-392b-4c78-b6e8-79e28ad61215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2d1940>]}
2021-10-28 16:44:16.062332 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:44:16.063599 (MainThread): 
2021-10-28 16:44:16.064104 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:44:16.065414 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:44:16.065841 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:44:16.766147 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:44:16.766791 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:44:16.779085 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:44:17.178157 (MainThread): 17:44:17 | Concurrency: 4 threads (target='dev')
2021-10-28 16:44:17.178702 (MainThread): 17:44:17 | 
2021-10-28 16:44:17.183652 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:44:17.184328 (Thread-1): 17:44:17 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:44:17.185107 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:44:17.185500 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:44:17.190263 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:44:17.191086 (Thread-1): finished collecting timing info
2021-10-28 16:44:17.216393 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:44:17.222271 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:44:17.785578 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:44:17.786278 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:44:20.035557 (Thread-1): finished collecting timing info
2021-10-28 16:44:20.036256 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3fcbf2f1-392b-4c78-b6e8-79e28ad61215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3a18e0>]}
2021-10-28 16:44:20.036793 (Thread-1): 17:44:20 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 2.85s]
2021-10-28 16:44:20.037057 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:44:20.037823 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:44:20.038204 (Thread-3): 17:44:20 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:44:20.038816 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:44:20.039078 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:44:20.040610 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61772), raddr=('142.250.185.10', 443)>
2021-10-28 16:44:20.040958 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61773), raddr=('142.250.184.170', 443)>
2021-10-28 16:44:20.041221 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61774), raddr=('142.250.185.10', 443)>
2021-10-28 16:44:20.041458 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61775), raddr=('142.250.184.170', 443)>
2021-10-28 16:44:20.044457 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:44:20.045088 (Thread-3): finished collecting timing info
2021-10-28 16:44:20.069085 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:44:20.069663 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:44:20.075334 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where nationality = "aus";


2021-10-28 16:44:21.779448 (Thread-3): finished collecting timing info
2021-10-28 16:44:21.780234 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3fcbf2f1-392b-4c78-b6e8-79e28ad61215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d44c4c0>]}
2021-10-28 16:44:21.780834 (Thread-3): 17:44:21 | 2 of 2 OK created view model ft_data.my_second_dbt_model............. [OK in 1.74s]
2021-10-28 16:44:21.781150 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:44:21.783034 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:44:21.783640 (MainThread): 17:44:21 | 
2021-10-28 16:44:21.783936 (MainThread): 17:44:21 | Finished running 1 table model, 1 view model in 5.72s.
2021-10-28 16:44:21.784196 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:44:21.784406 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:44:21.784602 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:44:21.786565 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61778), raddr=('142.250.185.10', 443)>
2021-10-28 16:44:21.786854 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61779), raddr=('142.250.184.170', 443)>
2021-10-28 16:44:21.792387 (MainThread): 
2021-10-28 16:44:21.792631 (MainThread): Completed successfully
2021-10-28 16:44:21.792817 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:44:21.793076 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c174820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c23d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3498b0>]}
2021-10-28 16:44:21.793350 (MainThread): Flushing usage events
2021-10-28 16:45:38.822554 (MainThread): Running with dbt=0.21.0
2021-10-28 16:45:39.122653 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:45:39.123821 (MainThread): Tracking: tracking
2021-10-28 16:45:39.134058 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c7550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090e9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090e91c0>]}
2021-10-28 16:45:39.145051 (MainThread): Partial parsing not enabled
2021-10-28 16:45:39.156443 (MainThread): Parsing macros/etc.sql
2021-10-28 16:45:39.159350 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:45:39.165544 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:45:39.187590 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:45:39.189983 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:45:39.192394 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:45:39.201627 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:45:39.204118 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:45:39.217822 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:45:39.219412 (MainThread): Parsing macros/core.sql
2021-10-28 16:45:39.222900 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:45:39.230024 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:45:39.239716 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:45:39.241296 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:45:39.257432 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:45:39.288159 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:45:39.309404 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:45:39.311037 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:45:39.320631 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:45:39.339791 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:45:39.356373 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:45:39.364732 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:45:39.371807 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:45:39.375512 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:45:39.376888 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:45:39.377773 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:45:39.379174 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:45:39.387339 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:45:39.388957 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:45:39.391156 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:45:39.392589 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:45:39.445243 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:45:39.446803 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:45:39.447884 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:45:39.449095 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:45:39.636741 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:45:39.648603 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:45:39.673752 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:45:39.675472 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:45:39.677196 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:45:39.678746 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:45:39.692575 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f223b1c-72db-4c22-bb82-de4956589981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109164040>]}
2021-10-28 16:45:39.696916 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:45:39.697284 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f223b1c-72db-4c22-bb82-de4956589981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109179460>]}
2021-10-28 16:45:39.697543 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:45:39.698866 (MainThread): 
2021-10-28 16:45:39.699356 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:45:39.700476 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:45:39.700790 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:45:40.388406 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:45:40.389045 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:45:40.401204 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:45:40.911929 (MainThread): 17:45:40 | Concurrency: 4 threads (target='dev')
2021-10-28 16:45:40.912472 (MainThread): 17:45:40 | 
2021-10-28 16:45:40.917435 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:45:40.918139 (Thread-1): 17:45:40 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:45:40.918924 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:45:40.919310 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:45:40.924010 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:45:40.924755 (Thread-1): finished collecting timing info
2021-10-28 16:45:40.949624 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:45:40.955734 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:45:41.476357 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:45:41.476978 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:45:44.323259 (Thread-1): finished collecting timing info
2021-10-28 16:45:44.323961 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f223b1c-72db-4c22-bb82-de4956589981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e48b0>]}
2021-10-28 16:45:44.324510 (Thread-1): 17:45:44 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 3.41s]
2021-10-28 16:45:44.324779 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:45:44.325418 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:45:44.325805 (Thread-3): 17:45:44 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:45:44.326308 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:45:44.326717 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:45:44.328411 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61782), raddr=('142.250.200.74', 443)>
2021-10-28 16:45:44.328816 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61783), raddr=('142.250.184.170', 443)>
2021-10-28 16:45:44.329098 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61784), raddr=('142.250.200.74', 443)>
2021-10-28 16:45:44.329352 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61785), raddr=('142.250.184.170', 443)>
2021-10-28 16:45:44.332055 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:45:44.332587 (Thread-3): finished collecting timing info
2021-10-28 16:45:44.357302 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:45:44.357880 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:45:44.363607 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model` limit 1;


2021-10-28 16:45:45.751038 (Thread-3): finished collecting timing info
2021-10-28 16:45:45.751700 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f223b1c-72db-4c22-bb82-de4956589981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109358fa0>]}
2021-10-28 16:45:45.752278 (Thread-3): 17:45:45 | 2 of 2 OK created view model ft_data.my_second_dbt_model............. [OK in 1.43s]
2021-10-28 16:45:45.752553 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:45:45.753982 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:45:45.754379 (MainThread): 17:45:45 | 
2021-10-28 16:45:45.754567 (MainThread): 17:45:45 | Finished running 1 table model, 1 view model in 6.06s.
2021-10-28 16:45:45.754730 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:45:45.754862 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:45:45.754988 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:45:45.756457 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61789), raddr=('142.250.200.74', 443)>
2021-10-28 16:45:45.756685 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61790), raddr=('142.250.184.170', 443)>
2021-10-28 16:45:45.761005 (MainThread): 
2021-10-28 16:45:45.761222 (MainThread): Completed successfully
2021-10-28 16:45:45.761422 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:45:45.761652 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109179cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928b760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928b3d0>]}
2021-10-28 16:45:45.761894 (MainThread): Flushing usage events
2021-10-28 16:47:22.755187 (MainThread): Running with dbt=0.21.0
2021-10-28 16:47:23.051981 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:47:23.053066 (MainThread): Tracking: tracking
2021-10-28 16:47:23.063346 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108435280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3ec220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3ecf10>]}
2021-10-28 16:47:23.074940 (MainThread): Partial parsing not enabled
2021-10-28 16:47:23.085978 (MainThread): Parsing macros/etc.sql
2021-10-28 16:47:23.088782 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:47:23.094954 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:47:23.117446 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:47:23.120040 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:47:23.122490 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:47:23.131448 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:47:23.133847 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:47:23.147522 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:47:23.149142 (MainThread): Parsing macros/core.sql
2021-10-28 16:47:23.152738 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:47:23.159865 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:47:23.170252 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:47:23.171862 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:47:23.188500 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:47:23.219718 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:47:23.241232 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:47:23.242843 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:47:23.252586 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:47:23.271557 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:47:23.284742 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:47:23.292368 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:47:23.299530 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:47:23.303102 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:47:23.304475 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:47:23.305364 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:47:23.306765 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:47:23.314921 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:47:23.316701 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:47:23.318911 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:47:23.320342 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:47:23.372526 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:47:23.374075 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:47:23.375161 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:47:23.376380 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:47:23.566059 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:47:23.577718 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:47:23.602420 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:47:23.604325 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:47:23.606110 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:47:23.607698 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:47:23.621564 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '075fd512-86a0-4104-acc4-3d7ec670bf0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a591eb0>]}
2021-10-28 16:47:23.626009 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:47:23.626389 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '075fd512-86a0-4104-acc4-3d7ec670bf0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a591df0>]}
2021-10-28 16:47:23.626649 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:47:23.627969 (MainThread): 
2021-10-28 16:47:23.628550 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:47:23.629499 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:47:23.629809 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:47:24.358589 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:47:24.359234 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:47:24.371412 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:47:24.720331 (MainThread): 17:47:24 | Concurrency: 4 threads (target='dev')
2021-10-28 16:47:24.720829 (MainThread): 17:47:24 | 
2021-10-28 16:47:24.725586 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:47:24.726085 (Thread-2): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:47:24.726677 (Thread-1): 17:47:24 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:47:24.727215 (Thread-2): 17:47:24 | 2 of 2 START view model ft_data.my_second_dbt_model.................. [RUN]
2021-10-28 16:47:24.727974 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:47:24.728645 (Thread-2): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:47:24.728975 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:47:24.729217 (Thread-2): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:47:24.733482 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:47:24.735569 (Thread-2): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:47:24.736314 (Thread-1): finished collecting timing info
2021-10-28 16:47:24.742217 (Thread-2): finished collecting timing info
2021-10-28 16:47:24.752904 (Thread-2): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61798), raddr=('142.250.200.138', 443)>
2021-10-28 16:47:24.764567 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:47:24.764866 (Thread-2): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61799), raddr=('142.250.184.170', 443)>
2021-10-28 16:47:24.765627 (Thread-2): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61800), raddr=('142.250.200.138', 443)>
2021-10-28 16:47:24.765918 (Thread-2): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61801), raddr=('142.250.184.170', 443)>
2021-10-28 16:47:24.789466 (Thread-2): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:47:24.789802 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:47:24.790776 (Thread-2): Opening a new connection, currently in state init
2021-10-28 16:47:24.795968 (Thread-2): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace view `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `ft-data-330317.ft_data.orders` limit 10;


2021-10-28 16:47:25.403467 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:47:25.404156 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:47:26.432669 (Thread-2): finished collecting timing info
2021-10-28 16:47:26.433368 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '075fd512-86a0-4104-acc4-3d7ec670bf0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5056a0>]}
2021-10-28 16:47:26.433907 (Thread-2): 17:47:26 | 2 of 2 OK created view model ft_data.my_second_dbt_model............. [OK in 1.70s]
2021-10-28 16:47:26.434166 (Thread-2): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:47:28.288555 (Thread-1): finished collecting timing info
2021-10-28 16:47:28.289619 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '075fd512-86a0-4104-acc4-3d7ec670bf0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a653d00>]}
2021-10-28 16:47:28.290425 (Thread-1): 17:47:28 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 3.56s]
2021-10-28 16:47:28.290722 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:47:28.292650 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:47:28.293242 (MainThread): 17:47:28 | 
2021-10-28 16:47:28.293526 (MainThread): 17:47:28 | Finished running 1 view model, 1 table model in 4.66s.
2021-10-28 16:47:28.293772 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:47:28.293972 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:47:28.294161 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:47:28.301640 (MainThread): 
2021-10-28 16:47:28.301920 (MainThread): Completed successfully
2021-10-28 16:47:28.302288 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:47:28.302648 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4c3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084359a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108435700>]}
2021-10-28 16:47:28.302986 (MainThread): Flushing usage events
2021-10-28 16:48:48.180101 (MainThread): Running with dbt=0.21.0
2021-10-28 16:48:48.477404 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:48:48.478611 (MainThread): Tracking: tracking
2021-10-28 16:48:48.489093 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c36370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abebd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abeb0d0>]}
2021-10-28 16:48:48.500029 (MainThread): Partial parsing not enabled
2021-10-28 16:48:48.511079 (MainThread): Parsing macros/etc.sql
2021-10-28 16:48:48.513903 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:48:48.520162 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:48:48.542407 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:48:48.544941 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:48:48.547371 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:48:48.556324 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:48:48.558764 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:48:48.572034 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:48:48.573525 (MainThread): Parsing macros/core.sql
2021-10-28 16:48:48.577277 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:48:48.584196 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:48:48.593821 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:48:48.595476 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:48:48.612301 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:48:48.643304 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:48:48.664671 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:48:48.666232 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:48:48.675651 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:48:48.694321 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:48:48.707195 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:48:48.714803 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:48:48.721715 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:48:48.725215 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:48:48.726540 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:48:48.727392 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:48:48.728734 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:48:48.736598 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:48:48.738193 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:48:48.740357 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:48:48.741758 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:48:48.793495 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:48:48.795004 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:48:48.796193 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:48:48.797398 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:48:48.983550 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:48:48.994988 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:48:49.020917 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:48:49.022679 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:48:49.024413 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:48:49.025986 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:48:49.039633 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9535e5bb-3334-428b-ab92-abf784990aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acb70d0>]}
2021-10-28 16:48:49.044006 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:48:49.044410 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9535e5bb-3334-428b-ab92-abf784990aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad159a0>]}
2021-10-28 16:48:49.044667 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:48:49.046292 (MainThread): 
2021-10-28 16:48:49.046735 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:48:49.047621 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:48:49.047964 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:48:50.428180 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:48:50.428830 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:48:50.440912 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:48:50.988809 (MainThread): 17:48:50 | Concurrency: 4 threads (target='dev')
2021-10-28 16:48:50.989353 (MainThread): 17:48:50 | 
2021-10-28 16:48:50.994337 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:48:50.995072 (Thread-1): 17:48:50 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:48:50.995997 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:48:50.996467 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:48:51.001210 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:48:51.001983 (Thread-1): finished collecting timing info
2021-10-28 16:48:51.026636 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:48:51.032780 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:48:51.629915 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:48:51.630517 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:48:54.346627 (Thread-1): finished collecting timing info
2021-10-28 16:48:54.347331 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9535e5bb-3334-428b-ab92-abf784990aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ade6850>]}
2021-10-28 16:48:54.347873 (Thread-1): 17:48:54 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 3.35s]
2021-10-28 16:48:54.348137 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:48:54.348775 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:48:54.349166 (Thread-3): 17:48:54 | 2 of 2 START table model ft_data.my_second_dbt_model................. [RUN]
2021-10-28 16:48:54.349659 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:48:54.349894 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:48:54.351524 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61816), raddr=('142.250.200.138', 443)>
2021-10-28 16:48:54.351935 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61817), raddr=('142.250.178.170', 443)>
2021-10-28 16:48:54.352341 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61818), raddr=('142.250.200.138', 443)>
2021-10-28 16:48:54.352722 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61819), raddr=('142.250.178.170', 443)>
2021-10-28 16:48:54.355780 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:48:54.356307 (Thread-3): finished collecting timing info
2021-10-28 16:48:54.365697 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:48:54.372108 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:48:54.980945 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:48:55.212685 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:48:55.213827 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models


select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where nationality = 'aus'
  );
    
2021-10-28 16:48:57.089665 (Thread-3): finished collecting timing info
2021-10-28 16:48:57.090755 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9535e5bb-3334-428b-ab92-abf784990aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae58880>]}
2021-10-28 16:48:57.091539 (Thread-3): 17:48:57 | 2 of 2 OK created table model ft_data.my_second_dbt_model............ [CREATE TABLE (6.0 rows, 290.0 Bytes processed) in 2.74s]
2021-10-28 16:48:57.091844 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:48:57.093719 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:48:57.094335 (MainThread): 17:48:57 | 
2021-10-28 16:48:57.094638 (MainThread): 17:48:57 | Finished running 2 table models in 8.05s.
2021-10-28 16:48:57.094904 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:48:57.095117 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:48:57.095312 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:48:57.102787 (MainThread): 
2021-10-28 16:48:57.103085 (MainThread): Completed successfully
2021-10-28 16:48:57.103323 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:48:57.103653 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acfc5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acfc850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad8c6a0>]}
2021-10-28 16:48:57.103994 (MainThread): Flushing usage events
2021-10-28 16:58:03.466456 (MainThread): Running with dbt=0.21.0
2021-10-28 16:58:03.762112 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-10-28 16:58:03.762925 (MainThread): Tracking: tracking
2021-10-28 16:58:03.772780 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2b5370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11026bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11026b0d0>]}
2021-10-28 16:58:03.783986 (MainThread): Partial parsing not enabled
2021-10-28 16:58:03.795224 (MainThread): Parsing macros/etc.sql
2021-10-28 16:58:03.798111 (MainThread): Parsing macros/catalog.sql
2021-10-28 16:58:03.804405 (MainThread): Parsing macros/adapters.sql
2021-10-28 16:58:03.826531 (MainThread): Parsing macros/materializations/seed.sql
2021-10-28 16:58:03.828933 (MainThread): Parsing macros/materializations/view.sql
2021-10-28 16:58:03.831408 (MainThread): Parsing macros/materializations/table.sql
2021-10-28 16:58:03.840244 (MainThread): Parsing macros/materializations/copy.sql
2021-10-28 16:58:03.842623 (MainThread): Parsing macros/materializations/incremental.sql
2021-10-28 16:58:03.856026 (MainThread): Parsing macros/materializations/snapshot.sql
2021-10-28 16:58:03.857549 (MainThread): Parsing macros/core.sql
2021-10-28 16:58:03.860940 (MainThread): Parsing macros/materializations/test.sql
2021-10-28 16:58:03.868401 (MainThread): Parsing macros/materializations/helpers.sql
2021-10-28 16:58:03.878359 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-10-28 16:58:03.879988 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-10-28 16:58:03.897105 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-10-28 16:58:03.929104 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-10-28 16:58:03.950657 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-10-28 16:58:03.952235 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-10-28 16:58:03.961640 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-10-28 16:58:03.980252 (MainThread): Parsing macros/materializations/common/merge.sql
2021-10-28 16:58:03.993700 (MainThread): Parsing macros/materializations/table/table.sql
2021-10-28 16:58:04.001313 (MainThread): Parsing macros/materializations/view/view.sql
2021-10-28 16:58:04.008356 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-10-28 16:58:04.012086 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-10-28 16:58:04.013467 (MainThread): Parsing macros/etc/query.sql
2021-10-28 16:58:04.014345 (MainThread): Parsing macros/etc/is_incremental.sql
2021-10-28 16:58:04.015768 (MainThread): Parsing macros/etc/datetime.sql
2021-10-28 16:58:04.023639 (MainThread): Parsing macros/etc/where_subquery.sql
2021-10-28 16:58:04.025300 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-10-28 16:58:04.027470 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-10-28 16:58:04.028882 (MainThread): Parsing macros/adapters/common.sql
2021-10-28 16:58:04.080814 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-10-28 16:58:04.082412 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-10-28 16:58:04.083543 (MainThread): Parsing macros/schema_tests/unique.sql
2021-10-28 16:58:04.084797 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-10-28 16:58:04.271744 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:58:04.283409 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:58:04.309002 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:58:04.310743 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:58:04.312481 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:58:04.314045 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-10-28 16:58:04.327736 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5af23af-ded6-4850-a100-a3f5a9d892f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103390d0>]}
2021-10-28 16:58:04.332113 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-10-28 16:58:04.332485 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5af23af-ded6-4850-a100-a3f5a9d892f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103979a0>]}
2021-10-28 16:58:04.332741 (MainThread): Found 2 models, 4 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-10-28 16:58:04.334037 (MainThread): 
2021-10-28 16:58:04.334486 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:58:04.335437 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-10-28 16:58:04.335640 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-10-28 16:58:05.065896 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-10-28 16:58:05.066540 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-10-28 16:58:05.078461 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:58:05.680263 (MainThread): 17:58:05 | Concurrency: 4 threads (target='dev')
2021-10-28 16:58:05.680799 (MainThread): 17:58:05 | 
2021-10-28 16:58:05.685792 (Thread-1): Began running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:58:05.686469 (Thread-1): 17:58:05 | 1 of 2 START table model ft_data.my_first_dbt_model.................. [RUN]
2021-10-28 16:58:05.687235 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.my_first_dbt_model".
2021-10-28 16:58:05.687618 (Thread-1): Compiling model.freetrade_test.my_first_dbt_model
2021-10-28 16:58:05.691789 (Thread-1): Writing injected SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:58:05.692538 (Thread-1): finished collecting timing info
2021-10-28 16:58:05.716496 (Thread-1): Opening a new connection, currently in state closed
2021-10-28 16:58:05.722604 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:58:06.321968 (Thread-1): Writing runtime SQL for node "model.freetrade_test.my_first_dbt_model"
2021-10-28 16:58:06.322583 (Thread-1): On model.freetrade_test.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_first_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



SELECT * FROM `ft-data-330317.ft_source_data.clients` LIMIT 10

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-10-28 16:58:08.697230 (Thread-1): finished collecting timing info
2021-10-28 16:58:08.697916 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5af23af-ded6-4850-a100-a3f5a9d892f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110458400>]}
2021-10-28 16:58:08.698535 (Thread-1): 17:58:08 | 1 of 2 OK created table model ft_data.my_first_dbt_model............. [CREATE TABLE (10.0 rows, 49.3 KB processed) in 3.01s]
2021-10-28 16:58:08.698843 (Thread-1): Finished running node model.freetrade_test.my_first_dbt_model
2021-10-28 16:58:08.699668 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:58:08.699986 (Thread-3): 17:58:08 | 2 of 2 START table model ft_data.my_second_dbt_model................. [RUN]
2021-10-28 16:58:08.700524 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-10-28 16:58:08.700721 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-10-28 16:58:08.702037 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61856), raddr=('142.250.185.10', 443)>
2021-10-28 16:58:08.702280 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61857), raddr=('142.250.178.170', 443)>
2021-10-28 16:58:08.702464 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61858), raddr=('142.250.185.10', 443)>
2021-10-28 16:58:08.702648 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.1.4', 61859), raddr=('142.250.178.170', 443)>
2021-10-28 16:58:08.705584 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:58:08.706083 (Thread-3): finished collecting timing info
2021-10-28 16:58:08.713774 (Thread-3): Opening a new connection, currently in state init
2021-10-28 16:58:08.719829 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-10-28 16:58:09.263605 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-10-28 16:58:09.264891 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models


select *
from `ft-data-330317`.`ft_data`.`my_first_dbt_model`
where nationality = 'aus'
  );
    
2021-10-28 16:58:11.373307 (Thread-3): finished collecting timing info
2021-10-28 16:58:11.374360 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5af23af-ded6-4850-a100-a3f5a9d892f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104675e0>]}
2021-10-28 16:58:11.375127 (Thread-3): 17:58:11 | 2 of 2 OK created table model ft_data.my_second_dbt_model............ [CREATE TABLE (6.0 rows, 290.0 Bytes processed) in 2.67s]
2021-10-28 16:58:11.375426 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-10-28 16:58:11.377331 (MainThread): Acquiring new bigquery connection "master".
2021-10-28 16:58:11.377933 (MainThread): 17:58:11 | 
2021-10-28 16:58:11.378216 (MainThread): 17:58:11 | Finished running 2 table models in 7.04s.
2021-10-28 16:58:11.378465 (MainThread): Connection 'master' was properly closed.
2021-10-28 16:58:11.378666 (MainThread): Connection 'model.freetrade_test.my_first_dbt_model' was properly closed.
2021-10-28 16:58:11.378853 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-10-28 16:58:11.386359 (MainThread): 
2021-10-28 16:58:11.386641 (MainThread): Completed successfully
2021-10-28 16:58:11.386883 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-10-28 16:58:11.387205 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11033dee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11037bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11037b7c0>]}
2021-10-28 16:58:11.387558 (MainThread): Flushing usage events
2021-11-01 01:16:45.475359 (MainThread): Running with dbt=0.21.0
2021-11-01 01:16:46.146135 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 01:16:46.147705 (MainThread): Tracking: tracking
2021-11-01 01:16:46.171576 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11339ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113fafa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133893d0>]}
2021-11-01 01:16:46.183224 (MainThread): Partial parsing not enabled
2021-11-01 01:16:46.204927 (MainThread): Parsing macros/etc.sql
2021-11-01 01:16:46.208183 (MainThread): Parsing macros/catalog.sql
2021-11-01 01:16:46.214203 (MainThread): Parsing macros/adapters.sql
2021-11-01 01:16:46.235671 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 01:16:46.238053 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 01:16:46.240396 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 01:16:46.249838 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 01:16:46.252779 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 01:16:46.267337 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 01:16:46.269004 (MainThread): Parsing macros/core.sql
2021-11-01 01:16:46.272506 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 01:16:46.278842 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 01:16:46.288417 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 01:16:46.289994 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 01:16:46.306073 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 01:16:46.336861 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 01:16:46.358424 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 01:16:46.360040 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 01:16:46.369679 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 01:16:46.388200 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 01:16:46.401248 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 01:16:46.408763 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 01:16:46.415647 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 01:16:46.419122 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 01:16:46.420495 (MainThread): Parsing macros/etc/query.sql
2021-11-01 01:16:46.421349 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 01:16:46.422735 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 01:16:46.430472 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 01:16:46.432184 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 01:16:46.434428 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 01:16:46.435842 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 01:16:46.487343 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 01:16:46.488881 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 01:16:46.489946 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 01:16:46.491156 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 01:16:46.677990 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:16:46.690156 (MainThread): 1699: statically parsed example/my_second_dbt_model.sql
2021-11-01 01:16:46.690370 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-11-01 01:16:46.693243 (MainThread): Sending event: {'category': 'dbt', 'action': 'experimental_parser', 'label': 'c38f81c6-bea6-4dc7-8fa6-9a18ff24236d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134bd100>]}
2021-11-01 01:16:46.715977 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:16:46.717680 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:16:46.719583 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:16:46.721165 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:16:46.721592 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113532ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135329a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113532bb0>]}
2021-11-01 01:16:46.721798 (MainThread): Flushing usage events
2021-11-01 01:16:47.223033 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-11-01 01:16:47.223447 (MainThread): Encountered an error:
2021-11-01 01:16:47.223765 (MainThread): Compilation Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Model 'model.freetrade_test.my_second_dbt_model' (models/example/my_second_dbt_model.sql) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:16:47.233224 (MainThread): Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 433, in run
    self._runtime_initialize()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 149, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 87, in _runtime_initialize
    self.load_manifest()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 74, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 355, in load
    self.process_refs(self.root_project.project_name)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 715, in process_refs
    _process_refs_for_node(self.manifest, current_project, node)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 1026, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 799, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/exceptions.py", line 575, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/exceptions.py", line 444, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Model 'model.freetrade_test.my_second_dbt_model' (models/example/my_second_dbt_model.sql) depends on a node named 'my_first_dbt_model' which was not found

2021-11-01 01:17:15.112261 (MainThread): Running with dbt=0.21.0
2021-11-01 01:17:15.412866 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 01:17:15.413762 (MainThread): Tracking: tracking
2021-11-01 01:17:15.423177 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1b7700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c20d9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e19c040>]}
2021-11-01 01:17:15.434124 (MainThread): Partial parsing not enabled
2021-11-01 01:17:15.445272 (MainThread): Parsing macros/etc.sql
2021-11-01 01:17:15.448137 (MainThread): Parsing macros/catalog.sql
2021-11-01 01:17:15.454368 (MainThread): Parsing macros/adapters.sql
2021-11-01 01:17:15.476783 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 01:17:15.479170 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 01:17:15.481620 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 01:17:15.490380 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 01:17:15.492981 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 01:17:15.506510 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 01:17:15.508186 (MainThread): Parsing macros/core.sql
2021-11-01 01:17:15.511528 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 01:17:15.518441 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 01:17:15.528916 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 01:17:15.530821 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 01:17:15.547609 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 01:17:15.578826 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 01:17:15.600198 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 01:17:15.601821 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 01:17:15.611346 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 01:17:15.629899 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 01:17:15.642918 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 01:17:15.650582 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 01:17:15.658532 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 01:17:15.662166 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 01:17:15.663613 (MainThread): Parsing macros/etc/query.sql
2021-11-01 01:17:15.664500 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 01:17:15.665890 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 01:17:15.673904 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 01:17:15.675598 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 01:17:15.677829 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 01:17:15.679280 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 01:17:15.731906 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 01:17:15.733462 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 01:17:15.734548 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 01:17:15.735763 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 01:17:15.925681 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:17:15.937512 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-11-01 01:17:15.963449 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:17:15.965208 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:17:15.966950 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:17:15.968525 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:17:15.968880 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:17:15.969050 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:17:15.984787 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a01693f5-6635-45da-bfe6-01cd098620b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2889d0>]}
2021-11-01 01:17:15.991577 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 01:17:15.992010 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a01693f5-6635-45da-bfe6-01cd098620b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2f2ca0>]}
2021-11-01 01:17:15.992254 (MainThread): Found 2 models, 2 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-01 01:17:15.993495 (MainThread): 
2021-11-01 01:17:15.993816 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 01:17:15.994585 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 01:17:15.994752 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 01:17:16.469648 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 01:17:16.470307 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 01:17:16.482464 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:17:16.795205 (MainThread): 01:17:16 | Concurrency: 4 threads (target='dev')
2021-11-01 01:17:16.795739 (MainThread): 01:17:16 | 
2021-11-01 01:17:16.802154 (Thread-1): Began running node model.freetrade_test.account_logs
2021-11-01 01:17:16.802902 (Thread-1): 01:17:16 | 1 of 2 START table model ft_data.account_logs........................ [RUN]
2021-11-01 01:17:16.803702 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:17:16.804078 (Thread-1): Compiling model.freetrade_test.account_logs
2021-11-01 01:17:16.808927 (Thread-1): Writing injected SQL for node "model.freetrade_test.account_logs"
2021-11-01 01:17:16.809800 (Thread-1): finished collecting timing info
2021-11-01 01:17:16.853365 (Thread-1): Writing runtime SQL for node "model.freetrade_test.account_logs"
2021-11-01 01:17:16.853895 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 01:17:16.858996 (Thread-1): On model.freetrade_test.account_logs: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_logs"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_logs`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`), buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'), sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'), cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   * ,
         sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 01:17:19.367350 (Thread-1): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64660), raddr=('142.250.180.10', 443)>
2021-11-01 01:17:19.367802 (Thread-1): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64661), raddr=('142.250.187.234', 443)>
2021-11-01 01:17:19.368213 (Thread-1): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64662), raddr=('142.250.180.10', 443)>
2021-11-01 01:17:19.369283 (Thread-1): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64663), raddr=('142.250.187.234', 443)>
2021-11-01 01:17:19.373527 (Thread-1): finished collecting timing info
2021-11-01 01:17:19.374196 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01693f5-6635-45da-bfe6-01cd098620b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f44b2b0>]}
2021-11-01 01:17:19.374711 (Thread-1): 01:17:19 | 1 of 2 OK created table model ft_data.account_logs................... [CREATE TABLE (37.9k rows, 1.0 MB processed) in 2.57s]
2021-11-01 01:17:19.374969 (Thread-1): Finished running node model.freetrade_test.account_logs
2021-11-01 01:17:19.375614 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-11-01 01:17:19.375984 (Thread-3): 01:17:19 | 2 of 2 START table model ft_data.my_second_dbt_model................. [RUN]
2021-11-01 01:17:19.376683 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-11-01 01:17:19.376934 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-11-01 01:17:19.387980 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-11-01 01:17:19.388548 (Thread-3): finished collecting timing info
2021-11-01 01:17:19.390183 (Thread-3): Opening a new connection, currently in state init
2021-11-01 01:17:19.396378 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:17:19.669144 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-11-01 01:17:19.670310 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models


select *
from `ft-data-330317`.`ft_data`.`account_logs`
where nationality = 'aus'
  );
    
2021-11-01 01:17:20.386349 (Thread-3): Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: nationality at [14:7]')
2021-11-01 01:17:22.708765 (Thread-3): finished collecting timing info
2021-11-01 01:17:22.709821 (Thread-3): Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Unrecognized name: nationality at [14:7]
  compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Unrecognized name: nationality at [14:7]

(job ID: fa7cf409-fd13-4dfa-857c-34fc360051dc)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */
   2:
   3:
   4:  create or replace table `ft-data-330317`.`ft_data`.`my_second_dbt_model`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- Use the `ref` function to select from other models
  10:
  11:
  12:select *
  13:from `ft-data-330317`.`ft_data`.`account_logs`
  14:where nationality = 'aus'
  15:  );
  16:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 128, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 167, in exception_handler
    self.handle_error(e, message)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 155, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
  Unrecognized name: nationality at [14:7]
  compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
2021-11-01 01:17:22.739541 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01693f5-6635-45da-bfe6-01cd098620b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f44b850>]}
2021-11-01 01:17:22.740406 (Thread-3): 01:17:22 | 2 of 2 ERROR creating table model ft_data.my_second_dbt_model........ [ERROR in 3.36s]
2021-11-01 01:17:22.740819 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-11-01 01:17:22.743263 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 01:17:22.743878 (MainThread): 01:17:22 | 
2021-11-01 01:17:22.744167 (MainThread): 01:17:22 | Finished running 2 table models in 6.75s.
2021-11-01 01:17:22.744417 (MainThread): Connection 'master' was properly closed.
2021-11-01 01:17:22.744616 (MainThread): Connection 'model.freetrade_test.account_logs' was properly closed.
2021-11-01 01:17:22.744805 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-11-01 01:17:22.754138 (MainThread): 
2021-11-01 01:17:22.754522 (MainThread): Completed with 1 error and 0 warnings:
2021-11-01 01:17:22.754824 (MainThread): 
2021-11-01 01:17:22.755064 (MainThread): Database Error in model my_second_dbt_model (models/example/my_second_dbt_model.sql)
2021-11-01 01:17:22.755265 (MainThread):   Unrecognized name: nationality at [14:7]
2021-11-01 01:17:22.755453 (MainThread):   compiled SQL at target/run/freetrade_test/models/example/my_second_dbt_model.sql
2021-11-01 01:17:22.755655 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-11-01 01:17:22.755984 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c20d430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e233820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e233880>]}
2021-11-01 01:17:22.756344 (MainThread): Flushing usage events
2021-11-01 01:18:22.895977 (MainThread): Running with dbt=0.21.0
2021-11-01 01:18:23.193384 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 01:18:23.194423 (MainThread): Tracking: tracking
2021-11-01 01:18:23.203970 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111aa9c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9f5a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a91160>]}
2021-11-01 01:18:23.215541 (MainThread): Partial parsing not enabled
2021-11-01 01:18:23.226945 (MainThread): Parsing macros/etc.sql
2021-11-01 01:18:23.229825 (MainThread): Parsing macros/catalog.sql
2021-11-01 01:18:23.236161 (MainThread): Parsing macros/adapters.sql
2021-11-01 01:18:23.258614 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 01:18:23.261080 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 01:18:23.263555 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 01:18:23.272434 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 01:18:23.274842 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 01:18:23.288182 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 01:18:23.289691 (MainThread): Parsing macros/core.sql
2021-11-01 01:18:23.293173 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 01:18:23.300187 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 01:18:23.310198 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 01:18:23.312413 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 01:18:23.328895 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 01:18:23.360648 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 01:18:23.382814 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 01:18:23.384460 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 01:18:23.393977 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 01:18:23.412892 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 01:18:23.425977 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 01:18:23.433661 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 01:18:23.440602 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 01:18:23.444139 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 01:18:23.445585 (MainThread): Parsing macros/etc/query.sql
2021-11-01 01:18:23.446449 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 01:18:23.447799 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 01:18:23.455973 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 01:18:23.457704 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 01:18:23.459939 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 01:18:23.461449 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 01:18:23.514852 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 01:18:23.516498 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 01:18:23.517668 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 01:18:23.519062 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 01:18:23.711662 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:18:23.723410 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-11-01 01:18:23.748815 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:18:23.750554 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:18:23.752293 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:18:23.753865 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:18:23.754220 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:18:23.754396 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:18:23.768023 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18158d41-d9c6-4c75-8c05-297d5ad53a30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b84340>]}
2021-11-01 01:18:23.772384 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 01:18:23.772742 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18158d41-d9c6-4c75-8c05-297d5ad53a30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111be3c70>]}
2021-11-01 01:18:23.772998 (MainThread): Found 2 models, 2 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-01 01:18:23.774384 (MainThread): 
2021-11-01 01:18:23.774911 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 01:18:23.775864 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 01:18:23.776066 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 01:18:24.156068 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 01:18:24.156732 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 01:18:24.169245 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:18:24.441585 (MainThread): 01:18:24 | Concurrency: 4 threads (target='dev')
2021-11-01 01:18:24.442126 (MainThread): 01:18:24 | 
2021-11-01 01:18:24.446274 (Thread-1): Began running node model.freetrade_test.account_logs
2021-11-01 01:18:24.446814 (Thread-1): 01:18:24 | 1 of 2 START table model ft_data.account_logs........................ [RUN]
2021-11-01 01:18:24.447425 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:18:24.447718 (Thread-1): Compiling model.freetrade_test.account_logs
2021-11-01 01:18:24.451910 (Thread-1): Writing injected SQL for node "model.freetrade_test.account_logs"
2021-11-01 01:18:24.452588 (Thread-1): finished collecting timing info
2021-11-01 01:18:24.474850 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 01:18:24.480663 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:18:24.798322 (Thread-1): Writing runtime SQL for node "model.freetrade_test.account_logs"
2021-11-01 01:18:24.798929 (Thread-1): On model.freetrade_test.account_logs: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_logs"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_logs`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`), buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'), sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'), cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   * ,
         sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 01:18:27.364151 (Thread-1): finished collecting timing info
2021-11-01 01:18:27.364875 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18158d41-d9c6-4c75-8c05-297d5ad53a30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ca69a0>]}
2021-11-01 01:18:27.365417 (Thread-1): 01:18:27 | 1 of 2 OK created table model ft_data.account_logs................... [CREATE TABLE (37.9k rows, 1.0 MB processed) in 2.92s]
2021-11-01 01:18:27.365682 (Thread-1): Finished running node model.freetrade_test.account_logs
2021-11-01 01:18:27.366329 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-11-01 01:18:27.366713 (Thread-3): 01:18:27 | 2 of 2 START table model ft_data.my_second_dbt_model................. [RUN]
2021-11-01 01:18:27.367206 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-11-01 01:18:27.367441 (Thread-3): Compiling model.freetrade_test.my_second_dbt_model
2021-11-01 01:18:27.369034 (Thread-3): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64670), raddr=('142.250.180.10', 443)>
2021-11-01 01:18:27.369545 (Thread-3): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64671), raddr=('142.250.187.234', 443)>
2021-11-01 01:18:27.369923 (Thread-3): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64672), raddr=('142.250.180.10', 443)>
2021-11-01 01:18:27.370202 (Thread-3): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64673), raddr=('142.250.187.234', 443)>
2021-11-01 01:18:27.373332 (Thread-3): Writing injected SQL for node "model.freetrade_test.my_second_dbt_model"
2021-11-01 01:18:27.373875 (Thread-3): finished collecting timing info
2021-11-01 01:18:27.382342 (Thread-3): Opening a new connection, currently in state init
2021-11-01 01:18:27.388735 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:18:27.671422 (Thread-3): Writing runtime SQL for node "model.freetrade_test.my_second_dbt_model"
2021-11-01 01:18:27.672502 (Thread-3): On model.freetrade_test.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.my_second_dbt_model"} */


  create or replace table `ft-data-330317`.`ft_data`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models


select *
from `ft-data-330317`.`ft_data`.`account_logs`
where customer_id = 1539
  );
    
2021-11-01 01:18:29.579829 (Thread-3): finished collecting timing info
2021-11-01 01:18:29.580604 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18158d41-d9c6-4c75-8c05-297d5ad53a30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cb4a60>]}
2021-11-01 01:18:29.581191 (Thread-3): 01:18:29 | 2 of 2 OK created table model ft_data.my_second_dbt_model............ [CREATE TABLE (2.1k rows, 1.4 MB processed) in 2.21s]
2021-11-01 01:18:29.581532 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-11-01 01:18:29.583822 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 01:18:29.584482 (MainThread): 01:18:29 | 
2021-11-01 01:18:29.584785 (MainThread): 01:18:29 | Finished running 2 table models in 5.81s.
2021-11-01 01:18:29.585040 (MainThread): Connection 'master' was properly closed.
2021-11-01 01:18:29.585244 (MainThread): Connection 'model.freetrade_test.account_logs' was properly closed.
2021-11-01 01:18:29.585451 (MainThread): Connection 'model.freetrade_test.my_second_dbt_model' was properly closed.
2021-11-01 01:18:29.592795 (MainThread): 
2021-11-01 01:18:29.593045 (MainThread): Completed successfully
2021-11-01 01:18:29.593232 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-11-01 01:18:29.593496 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111be3c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bc8af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bc8280>]}
2021-11-01 01:18:29.593769 (MainThread): Flushing usage events
2021-11-01 01:26:40.223330 (MainThread): Running with dbt=0.21.0
2021-11-01 01:26:40.518871 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 01:26:40.519751 (MainThread): Tracking: tracking
2021-11-01 01:26:40.530450 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9ca880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba21ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9b0160>]}
2021-11-01 01:26:40.541541 (MainThread): Partial parsing not enabled
2021-11-01 01:26:40.552985 (MainThread): Parsing macros/etc.sql
2021-11-01 01:26:40.555908 (MainThread): Parsing macros/catalog.sql
2021-11-01 01:26:40.562074 (MainThread): Parsing macros/adapters.sql
2021-11-01 01:26:40.584073 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 01:26:40.586473 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 01:26:40.588895 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 01:26:40.597905 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 01:26:40.600435 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 01:26:40.614235 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 01:26:40.615806 (MainThread): Parsing macros/core.sql
2021-11-01 01:26:40.619313 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 01:26:40.626189 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 01:26:40.636816 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 01:26:40.638440 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 01:26:40.654939 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 01:26:40.686229 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 01:26:40.707880 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 01:26:40.709509 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 01:26:40.719144 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 01:26:40.738107 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 01:26:40.751131 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 01:26:40.758783 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 01:26:40.766023 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 01:26:40.769740 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 01:26:40.771135 (MainThread): Parsing macros/etc/query.sql
2021-11-01 01:26:40.772026 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 01:26:40.773594 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 01:26:40.781605 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 01:26:40.783237 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 01:26:40.785478 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 01:26:40.786910 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 01:26:40.839323 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 01:26:40.840901 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 01:26:40.841986 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 01:26:40.843345 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 01:26:41.038091 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:26:41.050501 (MainThread): Acquiring new bigquery connection "model.freetrade_test.my_second_dbt_model".
2021-11-01 01:26:41.077537 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:26:41.079371 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:26:41.081340 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:26:41.083062 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 01:26:41.083453 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:26:41.083612 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 01:26:41.099561 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '65e9b789-0d8d-43a9-824a-fce397ed8616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daa5340>]}
2021-11-01 01:26:41.104587 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 01:26:41.104966 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '65e9b789-0d8d-43a9-824a-fce397ed8616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db05c70>]}
2021-11-01 01:26:41.105196 (MainThread): Found 2 models, 2 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-01 01:26:41.106476 (MainThread): 
2021-11-01 01:26:41.106816 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 01:26:41.107802 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 01:26:41.107967 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 01:26:41.551074 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 01:26:41.551347 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 01:26:41.557491 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:26:41.858162 (MainThread): 01:26:41 | Concurrency: 4 threads (target='dev')
2021-11-01 01:26:41.858701 (MainThread): 01:26:41 | 
2021-11-01 01:26:41.862838 (Thread-1): Began running node model.freetrade_test.account_logs
2021-11-01 01:26:41.863373 (Thread-1): 01:26:41 | 1 of 2 START table model ft_data.account_logs........................ [RUN]
2021-11-01 01:26:41.863976 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.account_logs".
2021-11-01 01:26:41.864270 (Thread-1): Compiling model.freetrade_test.account_logs
2021-11-01 01:26:41.868407 (Thread-1): Writing injected SQL for node "model.freetrade_test.account_logs"
2021-11-01 01:26:41.869078 (Thread-1): finished collecting timing info
2021-11-01 01:26:41.891373 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 01:26:41.897282 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 01:26:42.164969 (Thread-1): Writing runtime SQL for node "model.freetrade_test.account_logs"
2021-11-01 01:26:42.165497 (Thread-1): On model.freetrade_test.account_logs: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_logs"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_logs`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`), buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'), sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'), cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   * ,
         sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 01:26:42.528738 (Thread-1): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_logs"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_logs`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`), buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'), sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'), cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   * ,
         sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 01:26:42.529196 (Thread-1): 404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US

(job ID: 280a409b-0879-4831-8f88-b787b18e3560)

                                                             -----Query Job SQL Follows-----                                                              

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_logs"} */
   2:
   3:
   4:  create or replace table `ft-data-330317`.`ft_data`.`account_logs`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    /*
  10:    Welcome to your first dbt model!
  11:    Did you know that you can also configure models directly within SQL files?
  12:    This will override configurations stated in dbt_project.yml
  13:
  14:    Try changing "table" to "view" below
  15:*/
  16:
  17:
  18:
  19:WITH deposits AS
  20:(
  21:       SELECT customer_id,
  22:              deposited_at  AS log_datetime,
  23:              amount_in_gbp AS amount,
  24:              "deposit"     AS transaction_type
  25:       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
  26:(
  27:       SELECT customer_id,
  28:              requested_at AS log_datetime,
  29:              -amount      AS amount,
  30:              "withdrawal" AS transaction_type
  31:       FROM   `ft-data-330317.ft_source_data.withdrawals`), buys AS
  32:(
  33:       SELECT customer_id,
  34:              executed_at AS log_datetime,
  35:              -value      AS amount,
  36:              "buy"       AS transaction_type,
  37:       FROM   `ft-data-330317.ft_source_data.orders`
  38:       WHERE  side = 'buy'), sells AS
  39:(
  40:       SELECT customer_id,
  41:              executed_at AS log_datetime,
  42:              value       AS amount,
  43:              "sell"      AS transaction_type,
  44:       FROM   `ft-data-330317.ft_source_data.orders`
  45:       WHERE  side = 'sell'), cashflows AS
  46:(
  47:       SELECT *
  48:       FROM   withdrawals
  49:       UNION ALL
  50:                 (
  51:                        SELECT *
  52:                        FROM   deposits)
  53:          UNION ALL
  54:                    (
  55:                           SELECT *
  56:                           FROM   buys)
  57:             UNION ALL
  58:                       (
  59:                              SELECT *
  60:                              FROM   sells)
  61:             ORDER BY  customer_id,
  62:                       log_datetime)
  63:SELECT   * ,
  64:         sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
  65:FROM     cashflows
  66:ORDER BY log_datetime ASC
  67:
  68:/*
  69:    Uncomment the line below to remove records with null `id` values
  70:*/
  71:
  72:-- where id is not null
  73:  );
  74:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2021-11-01 01:26:42.529719 (Thread-1): finished collecting timing info
2021-11-01 01:26:42.530613 (Thread-1): Runtime Error in model account_logs (models/example/account_logs.sql)
  404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US
  
  (job ID: 280a409b-0879-4831-8f88-b787b18e3560)
Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US

(job ID: 280a409b-0879-4831-8f88-b787b18e3560)

                                                             -----Query Job SQL Follows-----                                                              

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_logs"} */
   2:
   3:
   4:  create or replace table `ft-data-330317`.`ft_data`.`account_logs`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    /*
  10:    Welcome to your first dbt model!
  11:    Did you know that you can also configure models directly within SQL files?
  12:    This will override configurations stated in dbt_project.yml
  13:
  14:    Try changing "table" to "view" below
  15:*/
  16:
  17:
  18:
  19:WITH deposits AS
  20:(
  21:       SELECT customer_id,
  22:              deposited_at  AS log_datetime,
  23:              amount_in_gbp AS amount,
  24:              "deposit"     AS transaction_type
  25:       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
  26:(
  27:       SELECT customer_id,
  28:              requested_at AS log_datetime,
  29:              -amount      AS amount,
  30:              "withdrawal" AS transaction_type
  31:       FROM   `ft-data-330317.ft_source_data.withdrawals`), buys AS
  32:(
  33:       SELECT customer_id,
  34:              executed_at AS log_datetime,
  35:              -value      AS amount,
  36:              "buy"       AS transaction_type,
  37:       FROM   `ft-data-330317.ft_source_data.orders`
  38:       WHERE  side = 'buy'), sells AS
  39:(
  40:       SELECT customer_id,
  41:              executed_at AS log_datetime,
  42:              value       AS amount,
  43:              "sell"      AS transaction_type,
  44:       FROM   `ft-data-330317.ft_source_data.orders`
  45:       WHERE  side = 'sell'), cashflows AS
  46:(
  47:       SELECT *
  48:       FROM   withdrawals
  49:       UNION ALL
  50:                 (
  51:                        SELECT *
  52:                        FROM   deposits)
  53:          UNION ALL
  54:                    (
  55:                           SELECT *
  56:                           FROM   buys)
  57:             UNION ALL
  58:                       (
  59:                              SELECT *
  60:                              FROM   sells)
  61:             ORDER BY  customer_id,
  62:                       log_datetime)
  63:SELECT   * ,
  64:         sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
  65:FROM     cashflows
  66:ORDER BY log_datetime ASC
  67:
  68:/*
  69:    Uncomment the line below to remove records with null `id` values
  70:*/
  71:
  72:-- where id is not null
  73:  );
  74:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 128, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 195, in exception_handler
    raise RuntimeException(exc_message)
dbt.exceptions.RuntimeException: Runtime Error in model account_logs (models/example/account_logs.sql)
  404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US
  
  (job ID: 280a409b-0879-4831-8f88-b787b18e3560)
2021-11-01 01:26:42.536315 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65e9b789-0d8d-43a9-824a-fce397ed8616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dbb7520>]}
2021-11-01 01:26:42.536940 (Thread-1): 01:26:42 | 1 of 2 ERROR creating table model ft_data.account_logs............... [ERROR in 0.67s]
2021-11-01 01:26:42.537239 (Thread-1): Finished running node model.freetrade_test.account_logs
2021-11-01 01:26:42.537948 (Thread-3): Began running node model.freetrade_test.my_second_dbt_model
2021-11-01 01:26:42.538229 (Thread-3): 01:26:42 | 2 of 2 SKIP relation ft_data.my_second_dbt_model..................... [SKIP]
2021-11-01 01:26:42.538686 (Thread-3): Finished running node model.freetrade_test.my_second_dbt_model
2021-11-01 01:26:42.540275 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 01:26:42.540792 (MainThread): 01:26:42 | 
2021-11-01 01:26:42.541038 (MainThread): 01:26:42 | Finished running 2 table models in 1.43s.
2021-11-01 01:26:42.541255 (MainThread): Connection 'master' was properly closed.
2021-11-01 01:26:42.541436 (MainThread): Connection 'model.freetrade_test.account_logs' was properly closed.
2021-11-01 01:26:42.543804 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64699), raddr=('142.250.187.202', 443)>
2021-11-01 01:26:42.544048 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64700), raddr=('142.250.187.234', 443)>
2021-11-01 01:26:42.544230 (MainThread): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64701), raddr=('142.250.187.202', 443)>
2021-11-01 01:26:42.544402 (MainThread): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64702), raddr=('142.250.187.234', 443)>
2021-11-01 01:26:42.544606 (MainThread): unclosed <ssl.SSLSocket fd=18, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64703), raddr=('142.250.187.202', 443)>
2021-11-01 01:26:42.544771 (MainThread): unclosed <ssl.SSLSocket fd=19, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 64704), raddr=('142.250.187.234', 443)>
2021-11-01 01:26:42.560192 (MainThread): 
2021-11-01 01:26:42.560421 (MainThread): Completed with 1 error and 0 warnings:
2021-11-01 01:26:42.560565 (MainThread): 
2021-11-01 01:26:42.560703 (MainThread): Runtime Error in model account_logs (models/example/account_logs.sql)
2021-11-01 01:26:42.560937 (MainThread):   404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US
2021-11-01 01:26:42.561080 (MainThread):   
2021-11-01 01:26:42.561204 (MainThread):   (job ID: 280a409b-0879-4831-8f88-b787b18e3560)
2021-11-01 01:26:42.561345 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=1 TOTAL=2
2021-11-01 01:26:42.561569 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da47a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daeaca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daea9a0>]}
2021-11-01 01:26:42.561802 (MainThread): Flushing usage events
2021-11-01 03:47:40.817601 (MainThread): Running with dbt=0.21.0
2021-11-01 03:47:41.268940 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 03:47:41.269958 (MainThread): Tracking: tracking
2021-11-01 03:47:41.287469 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e86280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103edc9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e6e3d0>]}
2021-11-01 03:47:41.298955 (MainThread): Partial parsing not enabled
2021-11-01 03:47:41.314239 (MainThread): Parsing macros/etc.sql
2021-11-01 03:47:41.317167 (MainThread): Parsing macros/catalog.sql
2021-11-01 03:47:41.323410 (MainThread): Parsing macros/adapters.sql
2021-11-01 03:47:41.345351 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 03:47:41.347719 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 03:47:41.350077 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 03:47:41.359016 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 03:47:41.361492 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 03:47:41.375754 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 03:47:41.377477 (MainThread): Parsing macros/core.sql
2021-11-01 03:47:41.381562 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 03:47:41.387896 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 03:47:41.397518 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 03:47:41.399064 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 03:47:41.415429 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 03:47:41.446431 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 03:47:41.468102 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 03:47:41.469720 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 03:47:41.479306 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 03:47:41.497810 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 03:47:41.510799 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 03:47:41.518383 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 03:47:41.525016 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 03:47:41.528589 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 03:47:41.529997 (MainThread): Parsing macros/etc/query.sql
2021-11-01 03:47:41.530849 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 03:47:41.532198 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 03:47:41.540181 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 03:47:41.541902 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 03:47:41.544089 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 03:47:41.545701 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 03:47:41.597545 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 03:47:41.599077 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 03:47:41.600162 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 03:47:41.601373 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 03:47:41.790298 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 03:47:41.802317 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 03:47:41.827942 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:47:41.829775 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:47:41.831554 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:47:41.833111 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:47:41.833476 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 03:47:41.833651 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 03:47:41.833831 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 03:47:41.834000 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 03:47:41.843668 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 03:47:41.848239 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b47b1df0-61e2-4834-8fc5-d865e5bc9686', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fcdaf0>]}
2021-11-01 03:47:41.852710 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 03:47:41.853074 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b47b1df0-61e2-4834-8fc5-d865e5bc9686', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fcdaf0>]}
2021-11-01 03:47:41.853336 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-01 03:47:41.854860 (MainThread): 
2021-11-01 03:47:41.855330 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 03:47:41.856227 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 03:47:41.856571 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 03:47:42.355042 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 03:47:42.355439 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 03:47:42.363892 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 03:47:42.641748 (MainThread): 03:47:42 | Concurrency: 4 threads (target='dev')
2021-11-01 03:47:42.642296 (MainThread): 03:47:42 | 
2021-11-01 03:47:42.646454 (Thread-1): Began running node model.freetrade_test.cashflows
2021-11-01 03:47:42.646974 (Thread-1): 03:47:42 | 1 of 2 START table model ft_data.cashflows........................... [RUN]
2021-11-01 03:47:42.647577 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 03:47:42.647874 (Thread-1): Compiling model.freetrade_test.cashflows
2021-11-01 03:47:42.652148 (Thread-1): Writing injected SQL for node "model.freetrade_test.cashflows"
2021-11-01 03:47:42.653024 (Thread-1): finished collecting timing info
2021-11-01 03:47:42.693641 (Thread-1): Writing runtime SQL for node "model.freetrade_test.cashflows"
2021-11-01 03:47:42.695123 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 03:47:42.700589 (Thread-1): On model.freetrade_test.cashflows: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */


  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`),

       buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'),

       sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'),

       cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   *
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 03:47:44.213794 (Thread-1): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */


  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`),

       buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'),

       sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'),

       cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   *
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 03:47:44.214288 (Thread-1): 404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US

(job ID: 5a211531-2ea6-4bb7-b6ed-25d6b44d80f0)

                                                            -----Query Job SQL Follows-----                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */
   2:
   3:
   4:  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    /*
  10:    Welcome to your first dbt model!
  11:    Did you know that you can also configure models directly within SQL files?
  12:    This will override configurations stated in dbt_project.yml
  13:
  14:    Try changing "table" to "view" below
  15:*/
  16:
  17:
  18:
  19:WITH deposits AS
  20:(
  21:       SELECT customer_id,
  22:              deposited_at  AS log_datetime,
  23:              amount_in_gbp AS amount,
  24:              "deposit"     AS transaction_type
  25:       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
  26:(
  27:       SELECT customer_id,
  28:              requested_at AS log_datetime,
  29:              -amount      AS amount,
  30:              "withdrawal" AS transaction_type
  31:       FROM   `ft-data-330317.ft_source_data.withdrawals`),
  32:
  33:       buys AS
  34:(
  35:       SELECT customer_id,
  36:              executed_at AS log_datetime,
  37:              -value      AS amount,
  38:              "buy"       AS transaction_type,
  39:       FROM   `ft-data-330317.ft_source_data.orders`
  40:       WHERE  side = 'buy'),
  41:
  42:       sells AS
  43:(
  44:       SELECT customer_id,
  45:              executed_at AS log_datetime,
  46:              value       AS amount,
  47:              "sell"      AS transaction_type,
  48:       FROM   `ft-data-330317.ft_source_data.orders`
  49:       WHERE  side = 'sell'),
  50:
  51:       cashflows AS
  52:(
  53:       SELECT *
  54:       FROM   withdrawals
  55:       UNION ALL
  56:                 (
  57:                        SELECT *
  58:                        FROM   deposits)
  59:          UNION ALL
  60:                    (
  61:                           SELECT *
  62:                           FROM   buys)
  63:             UNION ALL
  64:                       (
  65:                              SELECT *
  66:                              FROM   sells)
  67:             ORDER BY  customer_id,
  68:                       log_datetime)
  69:SELECT   *
  70:FROM     cashflows
  71:ORDER BY log_datetime ASC
  72:
  73:/*
  74:    Uncomment the line below to remove records with null `id` values
  75:*/
  76:
  77:-- where id is not null
  78:  );
  79:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2021-11-01 03:47:44.214855 (Thread-1): finished collecting timing info
2021-11-01 03:47:44.215756 (Thread-1): Runtime Error in model cashflows (models/accounts/cashflows.sql)
  404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US
  
  (job ID: 5a211531-2ea6-4bb7-b6ed-25d6b44d80f0)
Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US

(job ID: 5a211531-2ea6-4bb7-b6ed-25d6b44d80f0)

                                                            -----Query Job SQL Follows-----                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */
   2:
   3:
   4:  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    /*
  10:    Welcome to your first dbt model!
  11:    Did you know that you can also configure models directly within SQL files?
  12:    This will override configurations stated in dbt_project.yml
  13:
  14:    Try changing "table" to "view" below
  15:*/
  16:
  17:
  18:
  19:WITH deposits AS
  20:(
  21:       SELECT customer_id,
  22:              deposited_at  AS log_datetime,
  23:              amount_in_gbp AS amount,
  24:              "deposit"     AS transaction_type
  25:       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
  26:(
  27:       SELECT customer_id,
  28:              requested_at AS log_datetime,
  29:              -amount      AS amount,
  30:              "withdrawal" AS transaction_type
  31:       FROM   `ft-data-330317.ft_source_data.withdrawals`),
  32:
  33:       buys AS
  34:(
  35:       SELECT customer_id,
  36:              executed_at AS log_datetime,
  37:              -value      AS amount,
  38:              "buy"       AS transaction_type,
  39:       FROM   `ft-data-330317.ft_source_data.orders`
  40:       WHERE  side = 'buy'),
  41:
  42:       sells AS
  43:(
  44:       SELECT customer_id,
  45:              executed_at AS log_datetime,
  46:              value       AS amount,
  47:              "sell"      AS transaction_type,
  48:       FROM   `ft-data-330317.ft_source_data.orders`
  49:       WHERE  side = 'sell'),
  50:
  51:       cashflows AS
  52:(
  53:       SELECT *
  54:       FROM   withdrawals
  55:       UNION ALL
  56:                 (
  57:                        SELECT *
  58:                        FROM   deposits)
  59:          UNION ALL
  60:                    (
  61:                           SELECT *
  62:                           FROM   buys)
  63:             UNION ALL
  64:                       (
  65:                              SELECT *
  66:                              FROM   sells)
  67:             ORDER BY  customer_id,
  68:                       log_datetime)
  69:SELECT   *
  70:FROM     cashflows
  71:ORDER BY log_datetime ASC
  72:
  73:/*
  74:    Uncomment the line below to remove records with null `id` values
  75:*/
  76:
  77:-- where id is not null
  78:  );
  79:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 128, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 195, in exception_handler
    raise RuntimeException(exc_message)
dbt.exceptions.RuntimeException: Runtime Error in model cashflows (models/accounts/cashflows.sql)
  404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US
  
  (job ID: 5a211531-2ea6-4bb7-b6ed-25d6b44d80f0)
2021-11-01 03:47:44.225429 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b47b1df0-61e2-4834-8fc5-d865e5bc9686', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10612c370>]}
2021-11-01 03:47:44.226134 (Thread-1): 03:47:44 | 1 of 2 ERROR creating table model ft_data.cashflows.................. [ERROR in 1.58s]
2021-11-01 03:47:44.226456 (Thread-1): Finished running node model.freetrade_test.cashflows
2021-11-01 03:47:44.227230 (Thread-3): Began running node model.freetrade_test.account_timeseries
2021-11-01 03:47:44.227534 (Thread-3): 03:47:44 | 2 of 2 SKIP relation ft_data.account_timeseries...................... [SKIP]
2021-11-01 03:47:44.228113 (Thread-3): Finished running node model.freetrade_test.account_timeseries
2021-11-01 03:47:44.229849 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 03:47:44.230385 (MainThread): 03:47:44 | 
2021-11-01 03:47:44.230634 (MainThread): 03:47:44 | Finished running 2 table models in 2.38s.
2021-11-01 03:47:44.230850 (MainThread): Connection 'master' was properly closed.
2021-11-01 03:47:44.231025 (MainThread): Connection 'model.freetrade_test.cashflows' was properly closed.
2021-11-01 03:47:44.233275 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65171), raddr=('172.217.16.234', 443)>
2021-11-01 03:47:44.233609 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65172), raddr=('142.250.187.234', 443)>
2021-11-01 03:47:44.233805 (MainThread): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65173), raddr=('172.217.16.234', 443)>
2021-11-01 03:47:44.233992 (MainThread): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65174), raddr=('142.250.187.234', 443)>
2021-11-01 03:47:44.234220 (MainThread): unclosed <ssl.SSLSocket fd=18, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65175), raddr=('172.217.16.234', 443)>
2021-11-01 03:47:44.234402 (MainThread): unclosed <ssl.SSLSocket fd=19, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65176), raddr=('142.250.187.234', 443)>
2021-11-01 03:47:44.249737 (MainThread): 
2021-11-01 03:47:44.249968 (MainThread): Completed with 1 error and 0 warnings:
2021-11-01 03:47:44.250121 (MainThread): 
2021-11-01 03:47:44.250305 (MainThread): Runtime Error in model cashflows (models/accounts/cashflows.sql)
2021-11-01 03:47:44.250498 (MainThread):   404 Not found: Dataset ft-data-330317:ft_source_data was not found in location US
2021-11-01 03:47:44.250639 (MainThread):   
2021-11-01 03:47:44.250766 (MainThread):   (job ID: 5a211531-2ea6-4bb7-b6ed-25d6b44d80f0)
2021-11-01 03:47:44.250899 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=1 TOTAL=2
2021-11-01 03:47:44.251130 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fc6580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f31400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f67a00>]}
2021-11-01 03:47:44.251366 (MainThread): Flushing usage events
2021-11-01 03:48:15.504123 (MainThread): Running with dbt=0.21.0
2021-11-01 03:48:15.799503 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 03:48:15.800686 (MainThread): Tracking: tracking
2021-11-01 03:48:15.810668 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126cf280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110726be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126b83d0>]}
2021-11-01 03:48:15.821626 (MainThread): Partial parsing not enabled
2021-11-01 03:48:15.832881 (MainThread): Parsing macros/etc.sql
2021-11-01 03:48:15.835679 (MainThread): Parsing macros/catalog.sql
2021-11-01 03:48:15.841901 (MainThread): Parsing macros/adapters.sql
2021-11-01 03:48:15.865308 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 03:48:15.867808 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 03:48:15.870429 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 03:48:15.879649 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 03:48:15.882100 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 03:48:15.895437 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 03:48:15.896928 (MainThread): Parsing macros/core.sql
2021-11-01 03:48:15.900415 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 03:48:15.907191 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 03:48:15.917478 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 03:48:15.919123 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 03:48:15.935507 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 03:48:15.967108 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 03:48:15.988980 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 03:48:15.990582 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 03:48:16.000000 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 03:48:16.018682 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 03:48:16.031690 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 03:48:16.039271 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 03:48:16.046294 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 03:48:16.049931 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 03:48:16.051289 (MainThread): Parsing macros/etc/query.sql
2021-11-01 03:48:16.052170 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 03:48:16.053559 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 03:48:16.061523 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 03:48:16.063199 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 03:48:16.065435 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 03:48:16.066849 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 03:48:16.119400 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 03:48:16.120992 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 03:48:16.122070 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 03:48:16.123278 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 03:48:16.310511 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 03:48:16.322413 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 03:48:16.347464 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:48:16.349239 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:48:16.350977 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:48:16.352584 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 03:48:16.352951 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 03:48:16.353126 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 03:48:16.353309 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 03:48:16.353437 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 03:48:16.363554 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 03:48:16.368005 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd701e119-eeeb-4db5-b675-0f3d31384f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112813f40>]}
2021-11-01 03:48:16.372464 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 03:48:16.372824 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd701e119-eeeb-4db5-b675-0f3d31384f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112813df0>]}
2021-11-01 03:48:16.373053 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 184 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-01 03:48:16.374451 (MainThread): 
2021-11-01 03:48:16.374856 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 03:48:16.375734 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 03:48:16.376072 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 03:48:16.811450 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 03:48:16.812088 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 03:48:16.824193 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 03:48:17.104398 (MainThread): 03:48:17 | Concurrency: 4 threads (target='dev')
2021-11-01 03:48:17.104903 (MainThread): 03:48:17 | 
2021-11-01 03:48:17.109519 (Thread-1): Began running node model.freetrade_test.cashflows
2021-11-01 03:48:17.110203 (Thread-1): 03:48:17 | 1 of 2 START table model ft_data.cashflows........................... [RUN]
2021-11-01 03:48:17.110953 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 03:48:17.111353 (Thread-1): Compiling model.freetrade_test.cashflows
2021-11-01 03:48:17.115863 (Thread-1): Writing injected SQL for node "model.freetrade_test.cashflows"
2021-11-01 03:48:17.116648 (Thread-1): finished collecting timing info
2021-11-01 03:48:17.158604 (Thread-1): Writing runtime SQL for node "model.freetrade_test.cashflows"
2021-11-01 03:48:17.159229 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 03:48:17.164965 (Thread-1): On model.freetrade_test.cashflows: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */


  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`),

       buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'),

       sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'),

       cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   *
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 03:48:19.675896 (Thread-1): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65181), raddr=('172.217.169.42', 443)>
2021-11-01 03:48:19.676336 (Thread-1): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65182), raddr=('142.250.187.234', 443)>
2021-11-01 03:48:19.676651 (Thread-1): unclosed <ssl.SSLSocket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65183), raddr=('172.217.169.42', 443)>
2021-11-01 03:48:19.676934 (Thread-1): unclosed <ssl.SSLSocket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65184), raddr=('142.250.187.234', 443)>
2021-11-01 03:48:19.680029 (Thread-1): finished collecting timing info
2021-11-01 03:48:19.680648 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd701e119-eeeb-4db5-b675-0f3d31384f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11280c730>]}
2021-11-01 03:48:19.681176 (Thread-1): 03:48:19 | 1 of 2 OK created table model ft_data.cashflows...................... [CREATE TABLE (37.9k rows, 1.0 MB processed) in 2.57s]
2021-11-01 03:48:19.681442 (Thread-1): Finished running node model.freetrade_test.cashflows
2021-11-01 03:48:19.682216 (Thread-3): Began running node model.freetrade_test.account_timeseries
2021-11-01 03:48:19.682596 (Thread-3): 03:48:19 | 2 of 2 START table model ft_data.account_timeseries.................. [RUN]
2021-11-01 03:48:19.683212 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 03:48:19.683463 (Thread-3): Compiling model.freetrade_test.account_timeseries
2021-11-01 03:48:19.686922 (Thread-3): Writing injected SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 03:48:19.687467 (Thread-3): finished collecting timing info
2021-11-01 03:48:19.697363 (Thread-3): Writing runtime SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 03:48:19.697959 (Thread-3): Opening a new connection, currently in state init
2021-11-01 03:48:19.704187 (Thread-3): On model.freetrade_test.account_timeseries: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_timeseries"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_timeseries`
  
  
  OPTIONS()
  as (
    /*
A timeseries of account balances for each client binned every 4hrs.
Can definitely be tidied up - e.g. not use inline functions but need to figure out how to do this in dbt
*/




/*
 inline function to "tumble" datetimes into date bins
*/


    CREATE TEMP FUNCTION tumble_interval(
     val TIMESTAMP, tumble_seconds INT64)
    AS (
     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds));

/*
inline function to create the customer_id, datetime index onto which account data will be projected
*/

    CREATE TEMP FUNCTION
     gen_ts_candidates(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
    AS ((
     SELECT ARRAY_AGG(x)
     FROM (
       SELECT series_key, tumble_val
       FROM UNNEST(
         GENERATE_TIMESTAMP_ARRAY(
           tumble_interval(min_ts, tumble_seconds),
           tumble_interval(max_ts, tumble_seconds),
           INTERVAL tumble_seconds SECOND
         )
       ) AS tumble_val
       CROSS JOIN UNNEST(keys) AS series_key
     ) x
    ));

/*
Project/aggregate cashflow data into tumbled bins and project onto customer_id, datetime index
*/

    WITH event_logs AS
    (
             SELECT   * ,
                      sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
             FROM     `ft-data-330317`.`ft_data`.`cashflows`
             ORDER BY log_datetime ASC),

          agged_events AS
    (
             SELECT   sum(amount) delta,
                      customer_id,
                      tumble_interval(log_datetime, 21600) tumble
             FROM     event_logs
             GROUP BY customer_id,
                      tumble
             ORDER BY customer_id,
                      tumble ASC ),
           args AS
    (
           SELECT array_agg(DISTINCT customer_id) AS KEY,
                  min(tumble)                     AS min_ts,
                  max(tumble)                     AS max_ts
           FROM   agged_events ),

           timeseries AS
    (
                    SELECT          series_key         AS customer_id,
                                    tumble_val         AS tumble,
                                    COALESCE(delta, 0) AS def,
                                    delta              AS unfilled
                    FROM            unnest(
                                    (
                                           SELECT gen_ts_candidates(KEY, 21600, min_ts, max_ts)
                                           FROM   args) ) a
                    LEFT OUTER JOIN agged_events b
                    ON              a.series_key = b.customer_id
                    AND             a.tumble_val = b.tumble
                    ORDER BY        customer_id,
                                    tumble_val DESC)

    SELECT   customer_id,
             tumble                                                                                                           AS datetime,
             sum(def) OVER ( partition BY customer_id ORDER BY tumble rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row ) AS account_balance
    FROM     timeseries
    ORDER BY customer_id,
             tumble ASC
  );
    
2021-11-01 03:48:20.037315 (Thread-3): Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword CREATE at [22:5]')
2021-11-01 03:48:21.117973 (Thread-3): finished collecting timing info
2021-11-01 03:48:21.118907 (Thread-3): Database Error in model account_timeseries (models/accounts/account_timeseries.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword CREATE at [22:5]
  compiled SQL at target/run/freetrade_test/models/accounts/account_timeseries.sql
Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword CREATE at [22:5]

(job ID: 4e4e62f4-a87f-45a5-af7d-764af04efe4c)

                                                                -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_timeseries"} */
   2:
   3:
   4:  create or replace table `ft-data-330317`.`ft_data`.`account_timeseries`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    /*
  10:A timeseries of account balances for each client binned every 4hrs.
  11:Can definitely be tidied up - e.g. not use inline functions but need to figure out how to do this in dbt
  12:*/
  13:
  14:
  15:
  16:
  17:/*
  18: inline function to "tumble" datetimes into date bins
  19:*/
  20:
  21:
  22:    CREATE TEMP FUNCTION tumble_interval(
  23:     val TIMESTAMP, tumble_seconds INT64)
  24:    AS (
  25:     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds));
  26:
  27:/*
  28:inline function to create the customer_id, datetime index onto which account data will be projected
  29:*/
  30:
  31:    CREATE TEMP FUNCTION
  32:     gen_ts_candidates(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
  33:    AS ((
  34:     SELECT ARRAY_AGG(x)
  35:     FROM (
  36:       SELECT series_key, tumble_val
  37:       FROM UNNEST(
  38:         GENERATE_TIMESTAMP_ARRAY(
  39:           tumble_interval(min_ts, tumble_seconds),
  40:           tumble_interval(max_ts, tumble_seconds),
  41:           INTERVAL tumble_seconds SECOND
  42:         )
  43:       ) AS tumble_val
  44:       CROSS JOIN UNNEST(keys) AS series_key
  45:     ) x
  46:    ));
  47:
  48:/*
  49:Project/aggregate cashflow data into tumbled bins and project onto customer_id, datetime index
  50:*/
  51:
  52:    WITH event_logs AS
  53:    (
  54:             SELECT   * ,
  55:                      sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
  56:             FROM     `ft-data-330317`.`ft_data`.`cashflows`
  57:             ORDER BY log_datetime ASC),
  58:
  59:          agged_events AS
  60:    (
  61:             SELECT   sum(amount) delta,
  62:                      customer_id,
  63:                      tumble_interval(log_datetime, 21600) tumble
  64:             FROM     event_logs
  65:             GROUP BY customer_id,
  66:                      tumble
  67:             ORDER BY customer_id,
  68:                      tumble ASC ),
  69:           args AS
  70:    (
  71:           SELECT array_agg(DISTINCT customer_id) AS KEY,
  72:                  min(tumble)                     AS min_ts,
  73:                  max(tumble)                     AS max_ts
  74:           FROM   agged_events ),
  75:
  76:           timeseries AS
  77:    (
  78:                    SELECT          series_key         AS customer_id,
  79:                                    tumble_val         AS tumble,
  80:                                    COALESCE(delta, 0) AS def,
  81:                                    delta              AS unfilled
  82:                    FROM            unnest(
  83:                                    (
  84:                                           SELECT gen_ts_candidates(KEY, 21600, min_ts, max_ts)
  85:                                           FROM   args) ) a
  86:                    LEFT OUTER JOIN agged_events b
  87:                    ON              a.series_key = b.customer_id
  88:                    AND             a.tumble_val = b.tumble
  89:                    ORDER BY        customer_id,
  90:                                    tumble_val DESC)
  91:
  92:    SELECT   customer_id,
  93:             tumble                                                                                                           AS datetime,
  94:             sum(def) OVER ( partition BY customer_id ORDER BY tumble rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row ) AS account_balance
  95:    FROM     timeseries
  96:    ORDER BY customer_id,
  97:             tumble ASC
  98:  );
  99:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 128, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 167, in exception_handler
    self.handle_error(e, message)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 155, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model account_timeseries (models/accounts/account_timeseries.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword CREATE at [22:5]
  compiled SQL at target/run/freetrade_test/models/accounts/account_timeseries.sql
2021-11-01 03:48:21.124809 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd701e119-eeeb-4db5-b675-0f3d31384f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128d7d90>]}
2021-11-01 03:48:21.125443 (Thread-3): 03:48:21 | 2 of 2 ERROR creating table model ft_data.account_timeseries......... [ERROR in 1.44s]
2021-11-01 03:48:21.125760 (Thread-3): Finished running node model.freetrade_test.account_timeseries
2021-11-01 03:48:21.127654 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 03:48:21.128179 (MainThread): 03:48:21 | 
2021-11-01 03:48:21.128421 (MainThread): 03:48:21 | Finished running 2 table models in 4.75s.
2021-11-01 03:48:21.128628 (MainThread): Connection 'master' was properly closed.
2021-11-01 03:48:21.128797 (MainThread): Connection 'model.freetrade_test.cashflows' was properly closed.
2021-11-01 03:48:21.128956 (MainThread): Connection 'model.freetrade_test.account_timeseries' was properly closed.
2021-11-01 03:48:21.135665 (MainThread): 
2021-11-01 03:48:21.135885 (MainThread): Completed with 1 error and 0 warnings:
2021-11-01 03:48:21.136058 (MainThread): 
2021-11-01 03:48:21.136224 (MainThread): Database Error in model account_timeseries (models/accounts/account_timeseries.sql)
2021-11-01 03:48:21.136377 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword CREATE at [22:5]
2021-11-01 03:48:21.136519 (MainThread):   compiled SQL at target/run/freetrade_test/models/accounts/account_timeseries.sql
2021-11-01 03:48:21.136672 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-11-01 03:48:21.136922 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127dcca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11285ea60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11285ed00>]}
2021-11-01 03:48:21.137190 (MainThread): Flushing usage events
2021-11-01 04:03:57.539187 (MainThread): Running with dbt=0.21.0
2021-11-01 04:03:57.837037 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 04:03:57.838091 (MainThread): Tracking: tracking
2021-11-01 04:03:57.848316 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0e8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c147fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0d43d0>]}
2021-11-01 04:03:57.859434 (MainThread): Partial parsing not enabled
2021-11-01 04:03:57.871259 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 04:03:57.872422 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 04:03:57.872984 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 04:03:57.873799 (MainThread): Parsing macros/etc.sql
2021-11-01 04:03:57.876121 (MainThread): Parsing macros/catalog.sql
2021-11-01 04:03:57.882324 (MainThread): Parsing macros/adapters.sql
2021-11-01 04:03:57.904450 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 04:03:57.907086 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 04:03:57.909472 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 04:03:57.918248 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 04:03:57.920621 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 04:03:57.934115 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 04:03:57.935652 (MainThread): Parsing macros/core.sql
2021-11-01 04:03:57.939352 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 04:03:57.946929 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 04:03:57.956616 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 04:03:57.958202 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 04:03:57.974700 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 04:03:58.005938 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 04:03:58.027472 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 04:03:58.029050 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 04:03:58.038452 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 04:03:58.057373 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 04:03:58.070419 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 04:03:58.078278 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 04:03:58.085230 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 04:03:58.088942 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 04:03:58.090295 (MainThread): Parsing macros/etc/query.sql
2021-11-01 04:03:58.091153 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 04:03:58.092500 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 04:03:58.100327 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 04:03:58.102121 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 04:03:58.104484 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 04:03:58.106046 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 04:03:58.158212 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 04:03:58.159744 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 04:03:58.160812 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 04:03:58.162022 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 04:03:58.349066 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:03:58.362049 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:03:58.371858 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 04:03:58.397657 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:03:58.399396 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:03:58.401047 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:03:58.403855 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:03:58.404226 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:03:58.404401 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:03:58.404580 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:03:58.404731 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:03:58.413213 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 04:03:58.417805 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68278125-6d20-44e8-812a-514072678249', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1c22b0>]}
2021-11-01 04:03:58.422666 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 04:03:58.423073 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68278125-6d20-44e8-812a-514072678249', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1668b0>]}
2021-11-01 04:03:58.423488 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 187 macros, 1 operation, 0 seed files, 0 sources, 0 exposures
2021-11-01 04:03:58.424925 (MainThread): 
2021-11-01 04:03:58.425303 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:03:58.426075 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 04:03:58.426235 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 04:03:58.880657 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 04:03:58.881289 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 04:03:58.893470 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:03:59.154734 (MainThread): 04:03:59 | 
2021-11-01 04:03:59.155280 (MainThread): 04:03:59 | Running 1 on-run-start hook
2021-11-01 04:03:59.155662 (MainThread): Compiling operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:03:59.160595 (MainThread): Writing injected SQL for node "operation.freetrade_test.freetrade_test-on-run-start-0"
2021-11-01 04:03:59.163595 (MainThread): 04:03:59 | 1 of 1 START hook: freetrade_test.on-run-start.0..................... [RUN]
2021-11-01 04:03:59.164004 (MainThread): Opening a new connection, currently in state closed
2021-11-01 04:03:59.173183 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */


create schema if not exists ft_data;


    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
     val TIMESTAMP, tumble_seconds INT64)
    AS (
     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds));
$$ LANGUAGE sql
;


    CREATE OR REPLACE FUNCTION
     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
    AS ((
     SELECT ARRAY_AGG(x)
     FROM (
       SELECT series_key, tumble_val
       FROM UNNEST(
         GENERATE_TIMESTAMP_ARRAY(
           ft_data.tumble_interval(min_ts, tumble_seconds),
           ft_data.tumble_interval(max_ts, tumble_seconds),
           INTERVAL tumble_seconds SECOND
         )
       ) AS tumble_val
       CROSS JOIN UNNEST(keys) AS series_key
     ) x
    ));
$$ LANGUAGE sql
;


2021-11-01 04:03:59.174433 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65235), raddr=('142.250.179.234', 443)>
2021-11-01 04:03:59.174682 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65236), raddr=('172.217.16.234', 443)>
2021-11-01 04:03:59.450347 (MainThread): Retry attempt 1 of 1 after error: BadRequest('Syntax error: Illegal input character "$" at [11:1]')
2021-11-01 04:04:00.327854 (MainThread): Database error while running on-run-start
2021-11-01 04:04:00.328618 (MainThread): Connection 'master' was properly closed.
2021-11-01 04:04:00.328890 (MainThread): Connection 'list_ft-data-330317_ft_data' was properly closed.
2021-11-01 04:04:00.329824 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e22ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e22eb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e22eb80>]}
2021-11-01 04:04:00.330349 (MainThread): Flushing usage events
2021-11-01 04:04:00.894650 (MainThread): Encountered an error:
2021-11-01 04:04:00.895058 (MainThread): Database Error
  Syntax error: Illegal input character "$" at [11:1]
2021-11-01 04:04:00.899838 (MainThread): Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Illegal input character "$" at [11:1]

(job ID: 1c0d55b0-3752-4fde-8e5d-d5daa1e464ea)

                                                    -----Query Job SQL Follows-----                                                    

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */
   2:
   3:
   4:create schema if not exists ft_data;
   5:
   6:
   7:    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
   8:     val TIMESTAMP, tumble_seconds INT64)
   9:    AS (
  10:     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds));
  11:$$ LANGUAGE sql
  12:;
  13:
  14:
  15:    CREATE OR REPLACE FUNCTION
  16:     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
  17:    AS ((
  18:     SELECT ARRAY_AGG(x)
  19:     FROM (
  20:       SELECT series_key, tumble_val
  21:       FROM UNNEST(
  22:         GENERATE_TIMESTAMP_ARRAY(
  23:           ft_data.tumble_interval(min_ts, tumble_seconds),
  24:           ft_data.tumble_interval(max_ts, tumble_seconds),
  25:           INTERVAL tumble_seconds SECOND
  26:         )
  27:       ) AS tumble_val
  28:       CROSS JOIN UNNEST(keys) AS series_key
  29:     ) x
  30:    ));
  31:$$ LANGUAGE sql
  32:;
  33:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 452, in run
    result = self.execute_with_hooks(selected_uids)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 410, in execute_with_hooks
    self.before_run(adapter, selected_uids)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 413, in before_run
    self.safe_run_hooks(adapter, RunHookType.Start, {})
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 353, in safe_run_hooks
    self.run_hooks(adapter, hook_type, extra_context)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 335, in run_hooks
    status, _ = adapter.execute(sql, auto_begin=False,
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 167, in exception_handler
    self.handle_error(e, message)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 155, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error
  Syntax error: Illegal input character "$" at [11:1]

2021-11-01 04:06:10.705367 (MainThread): Running with dbt=0.21.0
2021-11-01 04:06:11.009094 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 04:06:11.010411 (MainThread): Tracking: tracking
2021-11-01 04:06:11.020895 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137fd730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118577c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137e3400>]}
2021-11-01 04:06:11.031869 (MainThread): Partial parsing not enabled
2021-11-01 04:06:11.043632 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 04:06:11.044797 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 04:06:11.045330 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 04:06:11.046108 (MainThread): Parsing macros/etc.sql
2021-11-01 04:06:11.048414 (MainThread): Parsing macros/catalog.sql
2021-11-01 04:06:11.054787 (MainThread): Parsing macros/adapters.sql
2021-11-01 04:06:11.077028 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 04:06:11.079476 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 04:06:11.081899 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 04:06:11.090945 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 04:06:11.093390 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 04:06:11.106747 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 04:06:11.108345 (MainThread): Parsing macros/core.sql
2021-11-01 04:06:11.112433 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 04:06:11.119319 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 04:06:11.128816 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 04:06:11.130514 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 04:06:11.146864 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 04:06:11.178208 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 04:06:11.199853 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 04:06:11.201467 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 04:06:11.211080 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 04:06:11.229571 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 04:06:11.242548 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 04:06:11.250350 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 04:06:11.257242 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 04:06:11.260803 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 04:06:11.262170 (MainThread): Parsing macros/etc/query.sql
2021-11-01 04:06:11.263042 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 04:06:11.264421 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 04:06:11.272476 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 04:06:11.274098 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 04:06:11.276276 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 04:06:11.277725 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 04:06:11.329615 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 04:06:11.331171 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 04:06:11.332263 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 04:06:11.333492 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 04:06:11.521961 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:06:11.534182 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:06:11.543732 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 04:06:11.569951 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:06:11.571779 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:06:11.573430 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:06:11.576276 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:06:11.576651 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:06:11.576828 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:06:11.577006 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:06:11.577157 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:06:11.586254 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 04:06:11.590829 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '82ef49da-81f5-4c12-af63-97468510ae46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138f7c10>]}
2021-11-01 04:06:11.595547 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 04:06:11.595918 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '82ef49da-81f5-4c12-af63-97468510ae46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138f74c0>]}
2021-11-01 04:06:11.596375 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 187 macros, 1 operation, 0 seed files, 0 sources, 0 exposures
2021-11-01 04:06:11.597802 (MainThread): 
2021-11-01 04:06:11.598218 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:06:11.599070 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 04:06:11.599372 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 04:06:11.964589 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 04:06:11.965236 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 04:06:11.977303 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:06:12.236654 (MainThread): 04:06:12 | 
2021-11-01 04:06:12.237208 (MainThread): 04:06:12 | Running 1 on-run-start hook
2021-11-01 04:06:12.237494 (MainThread): Compiling operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:06:12.242017 (MainThread): Writing injected SQL for node "operation.freetrade_test.freetrade_test-on-run-start-0"
2021-11-01 04:06:12.244678 (MainThread): 04:06:12 | 1 of 1 START hook: freetrade_test.on-run-start.0..................... [RUN]
2021-11-01 04:06:12.245074 (MainThread): Opening a new connection, currently in state closed
2021-11-01 04:06:12.254026 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */


create schema if not exists ft_data;


    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
     val TIMESTAMP, tumble_seconds INT64)
    AS (
     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds));
;


    CREATE OR REPLACE FUNCTION
     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
    AS ((
     SELECT ARRAY_AGG(x)
     FROM (
       SELECT series_key, tumble_val
       FROM UNNEST(
         GENERATE_TIMESTAMP_ARRAY(
           ft_data.tumble_interval(min_ts, tumble_seconds),
           ft_data.tumble_interval(max_ts, tumble_seconds),
           INTERVAL tumble_seconds SECOND
         )
       ) AS tumble_val
       CROSS JOIN UNNEST(keys) AS series_key
     ) x
    ));
;


2021-11-01 04:06:12.255333 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65244), raddr=('142.250.179.234', 443)>
2021-11-01 04:06:12.255574 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65245), raddr=('172.217.16.234', 443)>
2021-11-01 04:06:12.515893 (MainThread): Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected end of input but got ";" at [11:1]')
2021-11-01 04:06:13.668873 (MainThread): Database error while running on-run-start
2021-11-01 04:06:13.669853 (MainThread): Connection 'master' was properly closed.
2021-11-01 04:06:13.670199 (MainThread): Connection 'list_ft-data-330317_ft_data' was properly closed.
2021-11-01 04:06:13.670691 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11392a4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11392a880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11392a7f0>]}
2021-11-01 04:06:13.671247 (MainThread): Flushing usage events
2021-11-01 04:06:14.234521 (MainThread): Encountered an error:
2021-11-01 04:06:14.234923 (MainThread): Database Error
  Syntax error: Expected end of input but got ";" at [11:1]
2021-11-01 04:06:14.239554 (MainThread): Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 163, in exception_handler
    yield
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 345, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 552, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1450, in result
    do_get_result()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    return retry_target(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/retry.py", line 189, in retry_target
    return target()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/query.py", line 1440, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/cloud/bigquery/job/base.py", line 727, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/google/api_core/future/polling.py", line 135, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected end of input but got ";" at [11:1]

(job ID: ac8fab41-fceb-4f87-b627-6b8050063489)

                                                    -----Query Job SQL Follows-----                                                    

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */
   2:
   3:
   4:create schema if not exists ft_data;
   5:
   6:
   7:    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
   8:     val TIMESTAMP, tumble_seconds INT64)
   9:    AS (
  10:     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds));
  11:;
  12:
  13:
  14:    CREATE OR REPLACE FUNCTION
  15:     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
  16:    AS ((
  17:     SELECT ARRAY_AGG(x)
  18:     FROM (
  19:       SELECT series_key, tumble_val
  20:       FROM UNNEST(
  21:         GENERATE_TIMESTAMP_ARRAY(
  22:           ft_data.tumble_interval(min_ts, tumble_seconds),
  23:           ft_data.tumble_interval(max_ts, tumble_seconds),
  24:           INTERVAL tumble_seconds SECOND
  25:         )
  26:       ) AS tumble_val
  27:       CROSS JOIN UNNEST(keys) AS series_key
  28:     ) x
  29:    ));
  30:;
  31:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 452, in run
    result = self.execute_with_hooks(selected_uids)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 410, in execute_with_hooks
    self.before_run(adapter, selected_uids)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 413, in before_run
    self.safe_run_hooks(adapter, RunHookType.Start, {})
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 353, in safe_run_hooks
    self.run_hooks(adapter, hook_type, extra_context)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/run.py", line 335, in run_hooks
    status, _ = adapter.execute(sql, auto_begin=False,
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 356, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 347, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 566, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.9/3.9.7_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/contextlib.py", line 137, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 167, in exception_handler
    self.handle_error(e, message)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/adapters/bigquery/connections.py", line 155, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error
  Syntax error: Expected end of input but got ";" at [11:1]

2021-11-01 04:07:06.154884 (MainThread): Running with dbt=0.21.0
2021-11-01 04:07:06.454098 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 04:07:06.455283 (MainThread): Tracking: tracking
2021-11-01 04:07:06.465720 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10373d430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e78b0>]}
2021-11-01 04:07:06.477035 (MainThread): Partial parsing not enabled
2021-11-01 04:07:06.488976 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 04:07:06.490092 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 04:07:06.490632 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 04:07:06.491402 (MainThread): Parsing macros/etc.sql
2021-11-01 04:07:06.493818 (MainThread): Parsing macros/catalog.sql
2021-11-01 04:07:06.500200 (MainThread): Parsing macros/adapters.sql
2021-11-01 04:07:06.522527 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 04:07:06.524973 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 04:07:06.527402 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 04:07:06.536411 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 04:07:06.539016 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 04:07:06.552707 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 04:07:06.554343 (MainThread): Parsing macros/core.sql
2021-11-01 04:07:06.558160 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 04:07:06.565346 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 04:07:06.575214 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 04:07:06.576854 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 04:07:06.593725 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 04:07:06.625415 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 04:07:06.646946 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 04:07:06.648524 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 04:07:06.658133 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 04:07:06.676696 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 04:07:06.689821 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 04:07:06.697815 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 04:07:06.705157 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 04:07:06.709079 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 04:07:06.710638 (MainThread): Parsing macros/etc/query.sql
2021-11-01 04:07:06.711612 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 04:07:06.713049 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 04:07:06.722002 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 04:07:06.723897 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 04:07:06.726193 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 04:07:06.727668 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 04:07:06.780176 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 04:07:06.781694 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 04:07:06.782780 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 04:07:06.784080 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 04:07:06.974909 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:07:06.987562 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:07:06.997292 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 04:07:07.022837 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:07:07.024593 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:07:07.026251 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:07:07.029155 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:07:07.029539 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:07:07.029719 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:07:07.029902 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:07:07.030055 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:07:07.039048 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 04:07:07.043437 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4b720c8-c757-4db0-a6b4-fc56dd751df7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10577e220>]}
2021-11-01 04:07:07.048130 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 04:07:07.048504 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4b720c8-c757-4db0-a6b4-fc56dd751df7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057cbd30>]}
2021-11-01 04:07:07.048798 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 187 macros, 1 operation, 0 seed files, 0 sources, 0 exposures
2021-11-01 04:07:07.050275 (MainThread): 
2021-11-01 04:07:07.050697 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:07:07.051644 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 04:07:07.051847 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 04:07:07.432776 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 04:07:07.433421 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 04:07:07.445524 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:07:07.705942 (MainThread): 04:07:07 | 
2021-11-01 04:07:07.706464 (MainThread): 04:07:07 | Running 1 on-run-start hook
2021-11-01 04:07:07.706840 (MainThread): Compiling operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:07:07.711703 (MainThread): Writing injected SQL for node "operation.freetrade_test.freetrade_test-on-run-start-0"
2021-11-01 04:07:07.714363 (MainThread): 04:07:07 | 1 of 1 START hook: freetrade_test.on-run-start.0..................... [RUN]
2021-11-01 04:07:07.714773 (MainThread): Opening a new connection, currently in state closed
2021-11-01 04:07:07.724206 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */


create schema if not exists ft_data;


    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
     val TIMESTAMP, tumble_seconds INT64)
    AS (
     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds))
;


    CREATE OR REPLACE FUNCTION
     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
    AS ((
     SELECT ARRAY_AGG(x)
     FROM (
       SELECT series_key, tumble_val
       FROM UNNEST(
         GENERATE_TIMESTAMP_ARRAY(
           ft_data.tumble_interval(min_ts, tumble_seconds),
           ft_data.tumble_interval(max_ts, tumble_seconds),
           INTERVAL tumble_seconds SECOND
         )
       ) AS tumble_val
       CROSS JOIN UNNEST(keys) AS series_key
     ) x
    ))
;


2021-11-01 04:07:07.725471 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65252), raddr=('142.250.179.234', 443)>
2021-11-01 04:07:07.725712 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65253), raddr=('172.217.16.234', 443)>
2021-11-01 04:07:12.002524 (MainThread): 04:07:12 | 1 of 1 OK hook: freetrade_test.on-run-start.0........................ [SCRIPT (0.0 Bytes processed) in 4.29s]
2021-11-01 04:07:12.003099 (MainThread): 04:07:12 | 
2021-11-01 04:07:12.003787 (MainThread): 04:07:12 | Concurrency: 4 threads (target='dev')
2021-11-01 04:07:12.004077 (MainThread): 04:07:12 | 
2021-11-01 04:07:12.007466 (Thread-1): Began running node model.freetrade_test.cashflows
2021-11-01 04:07:12.012900 (Thread-1): 04:07:12 | 1 of 2 START table model ft_data.cashflows........................... [RUN]
2021-11-01 04:07:12.013446 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:07:12.013701 (Thread-1): Compiling model.freetrade_test.cashflows
2021-11-01 04:07:12.017064 (Thread-1): Writing injected SQL for node "model.freetrade_test.cashflows"
2021-11-01 04:07:12.017609 (Thread-1): finished collecting timing info
2021-11-01 04:07:12.038176 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 04:07:12.044216 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:07:12.322779 (Thread-1): Writing runtime SQL for node "model.freetrade_test.cashflows"
2021-11-01 04:07:12.323447 (Thread-1): On model.freetrade_test.cashflows: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */


  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`),

       buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'),

       sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'),

       cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   *
FROM     cashflows
ORDER BY log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 04:07:14.513169 (Thread-1): finished collecting timing info
2021-11-01 04:07:14.513884 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4b720c8-c757-4db0-a6b4-fc56dd751df7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058167f0>]}
2021-11-01 04:07:14.516013 (Thread-1): 04:07:14 | 1 of 2 OK created table model ft_data.cashflows...................... [CREATE TABLE (37.9k rows, 1.0 MB processed) in 2.50s]
2021-11-01 04:07:14.516415 (Thread-1): Finished running node model.freetrade_test.cashflows
2021-11-01 04:07:14.517172 (Thread-3): Began running node model.freetrade_test.account_timeseries
2021-11-01 04:07:14.517573 (Thread-3): 04:07:14 | 2 of 2 START table model ft_data.account_timeseries.................. [RUN]
2021-11-01 04:07:14.518106 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:07:14.518336 (Thread-3): Compiling model.freetrade_test.account_timeseries
2021-11-01 04:07:14.522991 (Thread-3): Writing injected SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 04:07:14.523663 (Thread-3): finished collecting timing info
2021-11-01 04:07:14.526358 (Thread-3): Writing runtime SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 04:07:14.526881 (Thread-3): Opening a new connection, currently in state init
2021-11-01 04:07:14.533498 (Thread-3): On model.freetrade_test.account_timeseries: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_timeseries"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_timeseries`
  
  
  OPTIONS()
  as (
    /*
A timeseries of account balances for each client binned every 4hrs.
Can definitely be tidied up - e.g. not use inline functions but need to figure out how to do this in dbt
*/



/*
Project/aggregate cashflow data into tumbled bins and project onto customer_id, datetime index
*/

    WITH event_logs AS
    (
             SELECT   * ,
                      sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
             FROM     `ft-data-330317`.`ft_data`.`cashflows`
             ORDER BY log_datetime ASC),

          agged_events AS
    (
             SELECT   sum(amount) delta,
                      customer_id,
                     ft_data.tumble_interval(log_datetime, 21600) tumble
             FROM     event_logs
             GROUP BY customer_id,
                      tumble
             ORDER BY customer_id,
                      tumble ASC ),
           args AS
    (
           SELECT array_agg(DISTINCT customer_id) AS KEY,
                  min(tumble)                     AS min_ts,
                  max(tumble)                     AS max_ts
           FROM   agged_events ),

           timeseries AS
    (
                    SELECT          series_key         AS customer_id,
                                    tumble_val         AS tumble,
                                    COALESCE(delta, 0) AS def,
                                    delta              AS unfilled
                    FROM            unnest(
                                    (
                                           SELECT  ft_data.timeseries_index(KEY, 21600, min_ts, max_ts)
                                           FROM   args) ) a
                    LEFT OUTER JOIN agged_events b
                    ON              a.series_key = b.customer_id
                    AND             a.tumble_val = b.tumble
                    ORDER BY        customer_id,
                                    tumble_val DESC)

    SELECT   customer_id,
             tumble                                                                                                           AS datetime,
             sum(def) OVER ( partition BY customer_id ORDER BY tumble rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row ) AS account_balance
    FROM     timeseries
    ORDER BY customer_id,
             tumble ASC
  );
    
2021-11-01 04:07:19.014486 (Thread-3): finished collecting timing info
2021-11-01 04:07:19.015570 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4b720c8-c757-4db0-a6b4-fc56dd751df7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059daf40>]}
2021-11-01 04:07:19.016266 (Thread-3): 04:07:19 | 2 of 2 OK created table model ft_data.account_timeseries............. [CREATE TABLE (1.1m rows, 888.4 KB processed) in 4.50s]
2021-11-01 04:07:19.016570 (Thread-3): Finished running node model.freetrade_test.account_timeseries
2021-11-01 04:07:19.018529 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:07:19.019147 (MainThread): 04:07:19 | 
2021-11-01 04:07:19.019432 (MainThread): 04:07:19 | Finished running 2 table models, 1 hook in 11.97s.
2021-11-01 04:07:19.019679 (MainThread): Connection 'master' was properly closed.
2021-11-01 04:07:19.019876 (MainThread): Connection 'model.freetrade_test.cashflows' was properly closed.
2021-11-01 04:07:19.020062 (MainThread): Connection 'model.freetrade_test.account_timeseries' was properly closed.
2021-11-01 04:07:19.027789 (MainThread): 
2021-11-01 04:07:19.028070 (MainThread): Completed successfully
2021-11-01 04:07:19.028302 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-11-01 04:07:19.028617 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ebe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059eb640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ebaf0>]}
2021-11-01 04:07:19.028880 (MainThread): Flushing usage events
2021-11-01 04:10:24.047666 (MainThread): Running with dbt=0.21.0
2021-11-01 04:10:24.596600 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 04:10:24.598431 (MainThread): Tracking: tracking
2021-11-01 04:10:24.617393 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a45dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084b4a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a444970>]}
2021-11-01 04:10:24.638002 (MainThread): Partial parsing not enabled
2021-11-01 04:10:24.661260 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 04:10:24.663226 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 04:10:24.664261 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 04:10:24.665783 (MainThread): Parsing macros/etc.sql
2021-11-01 04:10:24.670308 (MainThread): Parsing macros/catalog.sql
2021-11-01 04:10:24.682172 (MainThread): Parsing macros/adapters.sql
2021-11-01 04:10:24.727375 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 04:10:24.732442 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 04:10:24.737358 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 04:10:24.755442 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 04:10:24.760566 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 04:10:24.787935 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 04:10:24.791160 (MainThread): Parsing macros/core.sql
2021-11-01 04:10:24.798078 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 04:10:24.810618 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 04:10:24.829367 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 04:10:24.832469 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 04:10:24.865019 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 04:10:24.927660 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 04:10:24.971233 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 04:10:24.974476 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 04:10:24.993862 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 04:10:25.031985 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 04:10:25.058486 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 04:10:25.073795 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 04:10:25.088748 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 04:10:25.096856 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 04:10:25.100158 (MainThread): Parsing macros/etc/query.sql
2021-11-01 04:10:25.102108 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 04:10:25.105074 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 04:10:25.121281 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 04:10:25.124600 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 04:10:25.129119 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 04:10:25.132082 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 04:10:25.238237 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 04:10:25.241524 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 04:10:25.243792 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 04:10:25.246319 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 04:10:25.634532 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:10:25.658861 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:10:25.677914 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 04:10:25.729298 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:10:25.732802 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:10:25.736211 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:10:25.741800 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:10:25.742530 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:10:25.742850 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:10:25.743098 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:10:25.743329 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:10:25.760429 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 04:10:25.768916 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47285630-670e-4fd8-8a51-32e340304863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a55c880>]}
2021-11-01 04:10:25.778654 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 04:10:25.779497 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47285630-670e-4fd8-8a51-32e340304863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a55cfa0>]}
2021-11-01 04:10:25.779947 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 187 macros, 1 operation, 0 seed files, 0 sources, 0 exposures
2021-11-01 04:10:25.782212 (MainThread): 
2021-11-01 04:10:25.782900 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:10:25.784301 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 04:10:25.784753 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 04:10:26.272335 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 04:10:26.272954 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 04:10:26.284831 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:10:26.575160 (MainThread): 04:10:26 | 
2021-11-01 04:10:26.575647 (MainThread): 04:10:26 | Running 1 on-run-start hook
2021-11-01 04:10:26.575999 (MainThread): Compiling operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:10:26.580769 (MainThread): Writing injected SQL for node "operation.freetrade_test.freetrade_test-on-run-start-0"
2021-11-01 04:10:26.583498 (MainThread): 04:10:26 | 1 of 1 START hook: freetrade_test.on-run-start.0..................... [RUN]
2021-11-01 04:10:26.583917 (MainThread): Opening a new connection, currently in state closed
2021-11-01 04:10:26.594057 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */


create schema if not exists ft_data;


    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
     val TIMESTAMP, tumble_seconds INT64)
    AS (
     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds))
;


    CREATE OR REPLACE FUNCTION
     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
    AS ((
     SELECT ARRAY_AGG(x)
     FROM (
       SELECT series_key, tumble_val
       FROM UNNEST(
         GENERATE_TIMESTAMP_ARRAY(
           ft_data.tumble_interval(min_ts, tumble_seconds),
           ft_data.tumble_interval(max_ts, tumble_seconds),
           INTERVAL tumble_seconds SECOND
         )
       ) AS tumble_val
       CROSS JOIN UNNEST(keys) AS series_key
     ) x
    ))
;


2021-11-01 04:10:26.597587 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65273), raddr=('172.217.169.74', 443)>
2021-11-01 04:10:26.597915 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65274), raddr=('172.217.16.234', 443)>
2021-11-01 04:10:29.847906 (MainThread): 04:10:29 | 1 of 1 OK hook: freetrade_test.on-run-start.0........................ [SCRIPT (0.0 Bytes processed) in 3.26s]
2021-11-01 04:10:29.848509 (MainThread): 04:10:29 | 
2021-11-01 04:10:29.849397 (MainThread): 04:10:29 | Concurrency: 4 threads (target='dev')
2021-11-01 04:10:29.849687 (MainThread): 04:10:29 | 
2021-11-01 04:10:29.858404 (Thread-1): Began running node model.freetrade_test.cashflows
2021-11-01 04:10:29.858923 (Thread-1): 04:10:29 | 1 of 2 START table model ft_data.cashflows........................... [RUN]
2021-11-01 04:10:29.859520 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:10:29.859783 (Thread-1): Compiling model.freetrade_test.cashflows
2021-11-01 04:10:29.863679 (Thread-1): Writing injected SQL for node "model.freetrade_test.cashflows"
2021-11-01 04:10:29.864356 (Thread-1): finished collecting timing info
2021-11-01 04:10:29.931505 (Thread-1): Writing runtime SQL for node "model.freetrade_test.cashflows"
2021-11-01 04:10:29.932388 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 04:10:29.942308 (Thread-1): On model.freetrade_test.cashflows: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.cashflows"} */


  create or replace table `ft-data-330317`.`ft_data`.`cashflows`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`),

       buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'),

       sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'),

       cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   *
FROM     cashflows
ORDER BY customer_id, log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 04:10:32.473277 (Thread-1): finished collecting timing info
2021-11-01 04:10:32.474013 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47285630-670e-4fd8-8a51-32e340304863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a53cd90>]}
2021-11-01 04:10:32.474582 (Thread-1): 04:10:32 | 1 of 2 OK created table model ft_data.cashflows...................... [CREATE TABLE (37.9k rows, 1.0 MB processed) in 2.61s]
2021-11-01 04:10:32.474869 (Thread-1): Finished running node model.freetrade_test.cashflows
2021-11-01 04:10:32.475728 (Thread-3): Began running node model.freetrade_test.account_timeseries
2021-11-01 04:10:32.476311 (Thread-3): 04:10:32 | 2 of 2 START table model ft_data.account_timeseries.................. [RUN]
2021-11-01 04:10:32.476994 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:10:32.477267 (Thread-3): Compiling model.freetrade_test.account_timeseries
2021-11-01 04:10:32.482682 (Thread-3): Writing injected SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 04:10:32.483601 (Thread-3): finished collecting timing info
2021-11-01 04:10:32.486351 (Thread-3): Opening a new connection, currently in state init
2021-11-01 04:10:32.496695 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:10:32.754323 (Thread-3): Writing runtime SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 04:10:32.755219 (Thread-3): On model.freetrade_test.account_timeseries: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_timeseries"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_timeseries`
  
  
  OPTIONS()
  as (
    /*
A timeseries of account balances for each client binned every 4hrs.
Can definitely be tidied up - e.g. not use inline functions but need to figure out how to do this in dbt
*/



/*
Project/aggregate cashflow data into tumbled bins and project onto customer_id, datetime index
*/

    WITH event_logs AS
    (
             SELECT   * ,
                      sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
             FROM     `ft-data-330317`.`ft_data`.`cashflows`
             ORDER BY log_datetime ASC),

          agged_events AS
    (
             SELECT   sum(amount) delta,
                      customer_id,
                     ft_data.tumble_interval(log_datetime, 21600) tumble
             FROM     event_logs
             GROUP BY customer_id,
                      tumble
             ORDER BY customer_id,
                      tumble ASC ),
           args AS
    (
           SELECT array_agg(DISTINCT customer_id) AS KEY,
                  min(tumble)                     AS min_ts,
                  max(tumble)                     AS max_ts
           FROM   agged_events ),

           timeseries AS
    (
                    SELECT          series_key         AS customer_id,
                                    tumble_val         AS tumble,
                                    COALESCE(delta, 0) AS def,
                                    delta              AS unfilled
                    FROM            unnest(
                                    (
                                           SELECT  ft_data.timeseries_index(KEY, 21600, min_ts, max_ts)
                                           FROM   args) ) a
                    LEFT OUTER JOIN agged_events b
                    ON              a.series_key = b.customer_id
                    AND             a.tumble_val = b.tumble
                    ORDER BY        customer_id,
                                    tumble_val DESC)

    SELECT   customer_id,
             tumble                                                                                                           AS datetime,
             sum(def) OVER ( partition BY customer_id ORDER BY tumble rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row ) AS account_balance
    FROM     timeseries
    ORDER BY customer_id,
             tumble ASC
  );
    
2021-11-01 04:10:37.413095 (Thread-3): finished collecting timing info
2021-11-01 04:10:37.414234 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47285630-670e-4fd8-8a51-32e340304863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a53cd90>]}
2021-11-01 04:10:37.415094 (Thread-3): 04:10:37 | 2 of 2 OK created table model ft_data.account_timeseries............. [CREATE TABLE (1.1m rows, 888.4 KB processed) in 4.94s]
2021-11-01 04:10:37.415530 (Thread-3): Finished running node model.freetrade_test.account_timeseries
2021-11-01 04:10:37.417771 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:10:37.418405 (MainThread): 04:10:37 | 
2021-11-01 04:10:37.418700 (MainThread): 04:10:37 | Finished running 2 table models, 1 hook in 11.64s.
2021-11-01 04:10:37.418954 (MainThread): Connection 'master' was properly closed.
2021-11-01 04:10:37.419158 (MainThread): Connection 'model.freetrade_test.cashflows' was properly closed.
2021-11-01 04:10:37.419354 (MainThread): Connection 'model.freetrade_test.account_timeseries' was properly closed.
2021-11-01 04:10:37.427869 (MainThread): 
2021-11-01 04:10:37.428207 (MainThread): Completed successfully
2021-11-01 04:10:37.428462 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-11-01 04:10:37.428814 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a495910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4951f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a495be0>]}
2021-11-01 04:10:37.429188 (MainThread): Flushing usage events
2021-11-01 04:12:56.802579 (MainThread): Running with dbt=0.21.0
2021-11-01 04:12:57.356380 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, compile=True, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, cls=<class 'dbt.task.generate.GenerateTask'>, which='generate', rpc_method='docs.generate')
2021-11-01 04:12:57.358056 (MainThread): Tracking: tracking
2021-11-01 04:12:57.375264 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083cb8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10631d940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083b3040>]}
2021-11-01 04:12:57.396005 (MainThread): Partial parsing not enabled
2021-11-01 04:12:57.419160 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 04:12:57.421090 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 04:12:57.422084 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 04:12:57.423586 (MainThread): Parsing macros/etc.sql
2021-11-01 04:12:57.428129 (MainThread): Parsing macros/catalog.sql
2021-11-01 04:12:57.440036 (MainThread): Parsing macros/adapters.sql
2021-11-01 04:12:57.485553 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 04:12:57.490513 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 04:12:57.495531 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 04:12:57.513546 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 04:12:57.518505 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 04:12:57.545773 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 04:12:57.548895 (MainThread): Parsing macros/core.sql
2021-11-01 04:12:57.555770 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 04:12:57.568398 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 04:12:57.587162 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 04:12:57.590260 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 04:12:57.622809 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 04:12:57.685531 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 04:12:57.729093 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 04:12:57.732360 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 04:12:57.751632 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 04:12:57.789437 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 04:12:57.815856 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 04:12:57.831112 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 04:12:57.844886 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 04:12:57.852076 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 04:12:57.854838 (MainThread): Parsing macros/etc/query.sql
2021-11-01 04:12:57.856612 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 04:12:57.859406 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 04:12:57.875490 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 04:12:57.878823 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 04:12:57.883382 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 04:12:57.886349 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 04:12:57.992715 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 04:12:57.995858 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 04:12:57.998079 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 04:12:58.000591 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 04:12:58.384958 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:12:58.409139 (MainThread): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:12:58.428015 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 04:12:58.479314 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:12:58.482798 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:12:58.486185 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:12:58.491764 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 04:12:58.492481 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:12:58.492791 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 04:12:58.493051 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:12:58.493286 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 04:12:58.510318 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 04:12:58.518798 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a3f4e56-1f31-4947-a2f0-e2aae41ce127', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10849c2e0>]}
2021-11-01 04:12:58.527930 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 04:12:58.529096 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a3f4e56-1f31-4947-a2f0-e2aae41ce127', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10849cb50>]}
2021-11-01 04:12:58.529764 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 187 macros, 1 operation, 0 seed files, 0 sources, 0 exposures
2021-11-01 04:12:58.532285 (MainThread): 
2021-11-01 04:12:58.532959 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 04:12:58.534563 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 04:12:58.535045 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 04:12:58.546542 (ThreadPoolExecutor-0_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 04:12:58.834845 (MainThread): 04:12:58 | Concurrency: 4 threads (target='dev')
2021-11-01 04:12:58.835282 (MainThread): 04:12:58 | 
2021-11-01 04:12:58.839048 (Thread-1): Began running node model.freetrade_test.cashflows
2021-11-01 04:12:58.839746 (Thread-2): Began running node operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:12:58.840407 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.cashflows".
2021-11-01 04:12:58.841051 (Thread-2): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 04:12:58.841406 (Thread-1): Compiling model.freetrade_test.cashflows
2021-11-01 04:12:58.841687 (Thread-2): Compiling operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:12:58.844727 (Thread-1): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65302), raddr=('172.217.169.74', 443)>
2021-11-01 04:12:58.848343 (Thread-2): Writing injected SQL for node "operation.freetrade_test.freetrade_test-on-run-start-0"
2021-11-01 04:12:58.848806 (Thread-1): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('10.32.5.34', 65303), raddr=('172.217.16.234', 443)>
2021-11-01 04:12:58.851187 (Thread-1): Writing injected SQL for node "model.freetrade_test.cashflows"
2021-11-01 04:12:58.851826 (Thread-2): finished collecting timing info
2021-11-01 04:12:58.852182 (Thread-2): finished collecting timing info
2021-11-01 04:12:58.852741 (Thread-2): Finished running node operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 04:12:58.853128 (Thread-1): finished collecting timing info
2021-11-01 04:12:58.853391 (Thread-1): finished collecting timing info
2021-11-01 04:12:58.853875 (Thread-1): Finished running node model.freetrade_test.cashflows
2021-11-01 04:12:58.854602 (Thread-4): Began running node model.freetrade_test.account_timeseries
2021-11-01 04:12:58.855128 (Thread-4): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 04:12:58.855371 (Thread-4): Compiling model.freetrade_test.account_timeseries
2021-11-01 04:12:58.865514 (Thread-4): Writing injected SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 04:12:58.866362 (Thread-4): finished collecting timing info
2021-11-01 04:12:58.866675 (Thread-4): finished collecting timing info
2021-11-01 04:12:58.867229 (Thread-4): Finished running node model.freetrade_test.account_timeseries
2021-11-01 04:12:58.868727 (MainThread): Connection 'master' was properly closed.
2021-11-01 04:12:58.868964 (MainThread): Connection 'model.freetrade_test.cashflows' was properly closed.
2021-11-01 04:12:58.869152 (MainThread): Connection 'operation.freetrade_test.freetrade_test-on-run-start-0' was properly closed.
2021-11-01 04:12:58.869329 (MainThread): Connection 'model.freetrade_test.account_timeseries' was properly closed.
2021-11-01 04:12:58.877922 (MainThread): 04:12:58 | Done.
2021-11-01 04:12:58.883545 (MainThread): Acquiring new bigquery connection "generate_catalog".
2021-11-01 04:12:58.883849 (MainThread): 04:12:58 | Building catalog
2021-11-01 04:12:58.885103 (MainThread): Opening a new connection, currently in state init
2021-11-01 04:12:59.237353 (MainThread): Skipping catalog for ft-data-330317.ft_data_dbt_test__audit - schema does not exist
2021-11-01 04:12:59.238539 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "ft-data-330317.information_schema".
2021-11-01 04:12:59.263974 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state init
2021-11-01 04:12:59.273974 (ThreadPoolExecutor-1_0): On ft-data-330317.information_schema: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "ft-data-330317.information_schema"} */

    with tables as (
        select
            project_id as table_database,
            dataset_id as table_schema,
            table_id as original_table_name,

            concat(project_id, '.', dataset_id, '.', table_id) as relation_id,

            row_count,
            size_bytes as size_bytes,
            case
                when type = 1 then 'table'
                when type = 2 then 'view'
                else 'external'
            end as table_type,

            REGEXP_CONTAINS(table_id, '^.+[0-9]{8}$') and coalesce(type, 0) = 1 as is_date_shard,
            REGEXP_EXTRACT(table_id, '^(.+)[0-9]{8}$') as shard_base_name,
            REGEXP_EXTRACT(table_id, '^.+([0-9]{8})$') as shard_name

        from `ft-data-330317`.`ft_data`.__TABLES__
        where (upper(dataset_id) = upper('ft_data'))
    ),

    extracted as (

        select *,
            case
                when is_date_shard then shard_base_name
                else original_table_name
            end as table_name

        from tables

    ),

    unsharded_tables as (

        select
            table_database,
            table_schema,
            table_name,
            coalesce(table_type, 'external') as table_type,
            is_date_shard,

            struct(
                min(shard_name) as shard_min,
                max(shard_name) as shard_max,
                count(*) as shard_count
            ) as table_shards,

            sum(size_bytes) as size_bytes,
            sum(row_count) as row_count,

            max(relation_id) as relation_id

        from extracted
        group by 1,2,3,4,5

    ),

    info_schema_columns as (

        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            table_catalog as table_database,
            table_schema,
            table_name,

            -- use the "real" column name from the paths query below
            column_name as base_column_name,
            ordinal_position as column_index,

            is_partitioning_column,
            clustering_ordinal_position

        from `ft-data-330317`.`ft_data`.INFORMATION_SCHEMA.COLUMNS
        where ordinal_position is not null

    ),

    info_schema_column_paths as (

        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            field_path as column_name,
            data_type as column_type,
            column_name as base_column_name,
            description as column_comment

        from `ft-data-330317`.`ft_data`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS

    ),

    columns as (

        select * except (base_column_name)
        from info_schema_columns
        join info_schema_column_paths using (relation_id, base_column_name)

    ),

    column_stats as (

        select
            table_database,
            table_schema,
            table_name,
            max(relation_id) as relation_id,
            max(case when is_partitioning_column = 'YES' then 1 else 0 end) = 1 as is_partitioned,
            max(case when is_partitioning_column = 'YES' then column_name else null end) as partition_column,
            max(case when clustering_ordinal_position is not null then 1 else 0 end) = 1 as is_clustered,
            array_to_string(
                array_agg(
                    case
                        when clustering_ordinal_position is not null then column_name
                        else null
                    end ignore nulls
                    order by clustering_ordinal_position
                ), ', '
            ) as clustering_columns

        from columns
        group by 1,2,3

    )

    select
        unsharded_tables.table_database,
        unsharded_tables.table_schema,
        case
            when is_date_shard then concat(unsharded_tables.table_name, '*')
            else unsharded_tables.table_name
        end as table_name,
        unsharded_tables.table_type,

        -- coalesce name and type for External tables - these columns are not
        -- present in the COLUMN_FIELD_PATHS resultset
        coalesce(columns.column_name, '<unknown>') as column_name,
        -- invent a row number to account for nested fields -- BQ does
        -- not treat these nested properties as independent fields
        row_number() over (
            partition by relation_id
            order by columns.column_index, columns.column_name
        ) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        columns.column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_shards.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_shards.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_shards.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        (unsharded_tables.table_type = 'table') as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        (unsharded_tables.table_type = 'table') as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        is_clustered as `stats__clustering_fields__include`

    -- join using relation_id (an actual relation, not a shard prefix) to make
    -- sure that column metadata is picked up through the join. This will only
    -- return the column information for the "max" table in a date-sharded table set
    from unsharded_tables
    left join columns using (relation_id)
    left join column_stats using (relation_id)
  
2021-11-01 04:13:01.977977 (MainThread): 04:13:01 | Catalog written to /Users/stephenkyriacou/Projects/freetrade_dbt/ft_dbt/ft_dbt/target/catalog.json
2021-11-01 04:13:01.978444 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083cb8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086267c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108626b20>]}
2021-11-01 04:13:01.978817 (MainThread): Flushing usage events
2021-11-01 04:13:02.572881 (MainThread): Connection 'generate_catalog' was properly closed.
2021-11-01 04:13:02.573223 (MainThread): Connection 'ft-data-330317.information_schema' was properly closed.
2021-11-01 05:29:34.860369 (MainThread): Running with dbt=0.21.0
2021-11-01 05:29:35.334858 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 05:29:35.336796 (MainThread): Tracking: tracking
2021-11-01 05:29:35.348322 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1145dab20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126309d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1145c2400>]}
2021-11-01 05:29:35.359301 (MainThread): Partial parsing not enabled
2021-11-01 05:29:35.374620 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 05:29:35.375762 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 05:29:35.376341 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 05:29:35.377135 (MainThread): Parsing macros/etc.sql
2021-11-01 05:29:35.379574 (MainThread): Parsing macros/catalog.sql
2021-11-01 05:29:35.385826 (MainThread): Parsing macros/adapters.sql
2021-11-01 05:29:35.408091 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 05:29:35.410521 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 05:29:35.412968 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 05:29:35.422371 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 05:29:35.424865 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 05:29:35.439476 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 05:29:35.441178 (MainThread): Parsing macros/core.sql
2021-11-01 05:29:35.444666 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 05:29:35.451084 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 05:29:35.460682 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 05:29:35.462358 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 05:29:35.478846 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 05:29:35.511264 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 05:29:35.533379 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 05:29:35.535015 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 05:29:35.544910 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 05:29:35.564190 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 05:29:35.577823 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 05:29:35.585852 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 05:29:35.592961 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 05:29:35.596622 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 05:29:35.598068 (MainThread): Parsing macros/etc/query.sql
2021-11-01 05:29:35.598949 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 05:29:35.600335 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 05:29:35.608666 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 05:29:35.610647 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 05:29:35.612956 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 05:29:35.614420 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 05:29:35.668730 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 05:29:35.670330 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 05:29:35.671433 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 05:29:35.672668 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 05:29:35.866927 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 05:29:35.879530 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_cashflows".
2021-11-01 05:29:35.889525 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 05:29:35.916589 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:35.918392 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:35.920067 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:35.923121 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:35.923606 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147a1130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11477dac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11477dd60>]}
2021-11-01 05:29:35.923822 (MainThread): Flushing usage events
2021-11-01 05:29:37.512889 (MainThread): Connection 'operation.freetrade_test.freetrade_test-on-run-start-0' was properly closed.
2021-11-01 05:29:37.513326 (MainThread): Encountered an error:
2021-11-01 05:29:37.513637 (MainThread): Compilation Error in model account_timeseries (models/accounts/account_timeseries.sql)
  Model 'model.freetrade_test.account_timeseries' (models/accounts/account_timeseries.sql) depends on a node named 'cashflows' which was not found
2021-11-01 05:29:37.518322 (MainThread): Traceback (most recent call last):
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 433, in run
    self._runtime_initialize()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 149, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 87, in _runtime_initialize
    self.load_manifest()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/task/runnable.py", line 74, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 355, in load
    self.process_refs(self.root_project.project_name)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 715, in process_refs
    _process_refs_for_node(self.manifest, current_project, node)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 1026, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/parser/manifest.py", line 799, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/exceptions.py", line 575, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/stephenkyriacou/Projects/freetrade_dbt/freetrade_dbt/lib/python3.9/site-packages/dbt/exceptions.py", line 444, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model account_timeseries (models/accounts/account_timeseries.sql)
  Model 'model.freetrade_test.account_timeseries' (models/accounts/account_timeseries.sql) depends on a node named 'cashflows' which was not found

2021-11-01 05:29:58.045888 (MainThread): Running with dbt=0.21.0
2021-11-01 05:29:58.342348 (MainThread): running dbt with arguments Namespace(record_timing_info=None, debug=False, log_format='default', write_json=True, use_colors=None, strict=False, warn_error=False, partial_parse=None, single_threaded=False, test_new_parser=False, use_experimental_parser=False, project_dir=None, profiles_dir='/Users/stephenkyriacou/.dbt', profile=None, target=None, vars='{}', log_cache_events=False, use_cache=True, fail_fast=False, threads=None, version_check=True, select=None, exclude=None, selector_name=None, state=None, defer=None, full_refresh=True, cls=<class 'dbt.task.run.RunTask'>, which='run', rpc_method='run')
2021-11-01 05:29:58.343322 (MainThread): Tracking: tracking
2021-11-01 05:29:58.354318 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a89280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129d4be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a703d0>]}
2021-11-01 05:29:58.365802 (MainThread): Partial parsing not enabled
2021-11-01 05:29:58.377756 (MainThread): Parsing macros/create_udfs.sql
2021-11-01 05:29:58.378955 (MainThread): Parsing macros/udfs/tumble_interval.sql
2021-11-01 05:29:58.379496 (MainThread): Parsing macros/udfs/timeseries_index.sql
2021-11-01 05:29:58.380261 (MainThread): Parsing macros/etc.sql
2021-11-01 05:29:58.382567 (MainThread): Parsing macros/catalog.sql
2021-11-01 05:29:58.388830 (MainThread): Parsing macros/adapters.sql
2021-11-01 05:29:58.410919 (MainThread): Parsing macros/materializations/seed.sql
2021-11-01 05:29:58.413371 (MainThread): Parsing macros/materializations/view.sql
2021-11-01 05:29:58.415747 (MainThread): Parsing macros/materializations/table.sql
2021-11-01 05:29:58.424637 (MainThread): Parsing macros/materializations/copy.sql
2021-11-01 05:29:58.427080 (MainThread): Parsing macros/materializations/incremental.sql
2021-11-01 05:29:58.440584 (MainThread): Parsing macros/materializations/snapshot.sql
2021-11-01 05:29:58.442190 (MainThread): Parsing macros/core.sql
2021-11-01 05:29:58.445999 (MainThread): Parsing macros/materializations/test.sql
2021-11-01 05:29:58.452591 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-01 05:29:58.462115 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-01 05:29:58.464497 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-01 05:29:58.481533 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-01 05:29:58.513118 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-01 05:29:58.534577 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-01 05:29:58.536194 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-01 05:29:58.545645 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-01 05:29:58.564804 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-01 05:29:58.578182 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-01 05:29:58.586104 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-01 05:29:58.592825 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-01 05:29:58.596702 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-01 05:29:58.598124 (MainThread): Parsing macros/etc/query.sql
2021-11-01 05:29:58.599000 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-01 05:29:58.600394 (MainThread): Parsing macros/etc/datetime.sql
2021-11-01 05:29:58.608260 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-01 05:29:58.609899 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-01 05:29:58.612160 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-01 05:29:58.613631 (MainThread): Parsing macros/adapters/common.sql
2021-11-01 05:29:58.667476 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-01 05:29:58.669035 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-01 05:29:58.670125 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-01 05:29:58.671347 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-01 05:29:58.863586 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 05:29:58.875658 (MainThread): Acquiring new bigquery connection "model.freetrade_test.account_cashflows".
2021-11-01 05:29:58.886264 (MainThread): Acquiring new bigquery connection "operation.freetrade_test.freetrade_test-on-run-start-0".
2021-11-01 05:29:58.912063 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:58.913811 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:58.915455 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:58.918252 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-01 05:29:58.918623 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_first_dbt_model_id.16e066b321' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 05:29:58.918794 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_first_dbt_model_id.5fb22c2710' (models/accounts/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-01 05:29:58.918971 (MainThread): [WARNING]: Test 'test.freetrade_test.unique_my_second_dbt_model_id.57a0f8c493' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 05:29:58.919120 (MainThread): [WARNING]: Test 'test.freetrade_test.not_null_my_second_dbt_model_id.151b76d778' (models/accounts/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-01 05:29:58.929191 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.freetrade_test.example

2021-11-01 05:29:58.934296 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a513b8b2-de58-4c98-87ea-87b34a26eefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b64190>]}
2021-11-01 05:29:58.939261 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-01 05:29:58.939774 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a513b8b2-de58-4c98-87ea-87b34a26eefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b3e7f0>]}
2021-11-01 05:29:58.940101 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 187 macros, 1 operation, 0 seed files, 0 sources, 0 exposures
2021-11-01 05:29:58.941364 (MainThread): 
2021-11-01 05:29:58.941749 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 05:29:58.942573 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_ft-data-330317".
2021-11-01 05:29:58.942769 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-01 05:30:00.509607 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_ft-data-330317_ft_data".
2021-11-01 05:30:00.510240 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-01 05:30:00.522539 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 05:30:01.211481 (MainThread): 05:30:01 | 
2021-11-01 05:30:01.212025 (MainThread): 05:30:01 | Running 1 on-run-start hook
2021-11-01 05:30:01.212429 (MainThread): Compiling operation.freetrade_test.freetrade_test-on-run-start-0
2021-11-01 05:30:01.217428 (MainThread): Writing injected SQL for node "operation.freetrade_test.freetrade_test-on-run-start-0"
2021-11-01 05:30:01.220085 (MainThread): 05:30:01 | 1 of 1 START hook: freetrade_test.on-run-start.0..................... [RUN]
2021-11-01 05:30:01.220485 (MainThread): Opening a new connection, currently in state closed
2021-11-01 05:30:01.231384 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "connection_name": "master"} */


create schema if not exists ft_data;


    CREATE OR REPLACE FUNCTION ft_data.tumble_interval(
     val TIMESTAMP, tumble_seconds INT64)
    AS (
     timestamp_seconds(div(UNIX_SECONDS(val), tumble_seconds) *  tumble_seconds))
;


    CREATE OR REPLACE FUNCTION
     ft_data.timeseries_index(keys ARRAY<INT64>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)
    AS ((
     SELECT ARRAY_AGG(x)
     FROM (
       SELECT series_key, tumble_val
       FROM UNNEST(
         GENERATE_TIMESTAMP_ARRAY(
           ft_data.tumble_interval(min_ts, tumble_seconds),
           ft_data.tumble_interval(max_ts, tumble_seconds),
           INTERVAL tumble_seconds SECOND
         )
       ) AS tumble_val
       CROSS JOIN UNNEST(keys) AS series_key
     ) x
    ))
;


2021-11-01 05:30:01.235970 (MainThread): unclosed <ssl.SSLSocket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.3.167', 49219), raddr=('142.250.187.202', 443)>
2021-11-01 05:30:01.236487 (MainThread): unclosed <ssl.SSLSocket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('192.168.3.167', 49220), raddr=('142.250.200.42', 443)>
2021-11-01 05:30:05.768051 (MainThread): 05:30:05 | 1 of 1 OK hook: freetrade_test.on-run-start.0........................ [SCRIPT (0.0 Bytes processed) in 4.55s]
2021-11-01 05:30:05.768530 (MainThread): 05:30:05 | 
2021-11-01 05:30:05.769431 (MainThread): 05:30:05 | Concurrency: 4 threads (target='dev')
2021-11-01 05:30:05.770077 (MainThread): 05:30:05 | 
2021-11-01 05:30:05.773740 (Thread-1): Began running node model.freetrade_test.account_cashflows
2021-11-01 05:30:05.774376 (Thread-1): 05:30:05 | 1 of 2 START table model ft_data.account_cashflows................... [RUN]
2021-11-01 05:30:05.775343 (Thread-1): Acquiring new bigquery connection "model.freetrade_test.account_cashflows".
2021-11-01 05:30:05.775743 (Thread-1): Compiling model.freetrade_test.account_cashflows
2021-11-01 05:30:05.783792 (Thread-1): Writing injected SQL for node "model.freetrade_test.account_cashflows"
2021-11-01 05:30:05.784465 (Thread-1): finished collecting timing info
2021-11-01 05:30:05.830061 (Thread-1): Writing runtime SQL for node "model.freetrade_test.account_cashflows"
2021-11-01 05:30:05.830697 (Thread-1): Opening a new connection, currently in state closed
2021-11-01 05:30:05.836416 (Thread-1): On model.freetrade_test.account_cashflows: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_cashflows"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_cashflows`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



WITH deposits AS
(
       SELECT customer_id,
              deposited_at  AS log_datetime,
              amount_in_gbp AS amount,
              "deposit"     AS transaction_type
       FROM   `ft-data-330317.ft_source_data.deposits`), withdrawals AS
(
       SELECT customer_id,
              requested_at AS log_datetime,
              -amount      AS amount,
              "withdrawal" AS transaction_type
       FROM   `ft-data-330317.ft_source_data.withdrawals`),

       buys AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              -value      AS amount,
              "buy"       AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'buy'),

       sells AS
(
       SELECT customer_id,
              executed_at AS log_datetime,
              value       AS amount,
              "sell"      AS transaction_type,
       FROM   `ft-data-330317.ft_source_data.orders`
       WHERE  side = 'sell'),

       cashflows AS
(
       SELECT *
       FROM   withdrawals
       UNION ALL
                 (
                        SELECT *
                        FROM   deposits)
          UNION ALL
                    (
                           SELECT *
                           FROM   buys)
             UNION ALL
                       (
                              SELECT *
                              FROM   sells)
             ORDER BY  customer_id,
                       log_datetime)
SELECT   *
FROM     cashflows
ORDER BY customer_id, log_datetime ASC

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
    
2021-11-01 05:30:08.705485 (Thread-1): finished collecting timing info
2021-11-01 05:30:08.706170 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a513b8b2-de58-4c98-87ea-87b34a26eefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d6a160>]}
2021-11-01 05:30:08.706685 (Thread-1): 05:30:08 | 1 of 2 OK created table model ft_data.account_cashflows.............. [CREATE TABLE (37.9k rows, 1.0 MB processed) in 2.93s]
2021-11-01 05:30:08.706941 (Thread-1): Finished running node model.freetrade_test.account_cashflows
2021-11-01 05:30:08.707581 (Thread-3): Began running node model.freetrade_test.account_timeseries
2021-11-01 05:30:08.707962 (Thread-3): 05:30:08 | 2 of 2 START table model ft_data.account_timeseries.................. [RUN]
2021-11-01 05:30:08.708655 (Thread-3): Acquiring new bigquery connection "model.freetrade_test.account_timeseries".
2021-11-01 05:30:08.708911 (Thread-3): Compiling model.freetrade_test.account_timeseries
2021-11-01 05:30:08.713353 (Thread-3): Writing injected SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 05:30:08.713912 (Thread-3): finished collecting timing info
2021-11-01 05:30:08.715780 (Thread-3): Opening a new connection, currently in state init
2021-11-01 05:30:08.722561 (Thread-3): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-11-01 05:30:09.728634 (Thread-3): Writing runtime SQL for node "model.freetrade_test.account_timeseries"
2021-11-01 05:30:09.730764 (Thread-3): On model.freetrade_test.account_timeseries: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "freetrade_test", "target_name": "dev", "node_id": "model.freetrade_test.account_timeseries"} */


  create or replace table `ft-data-330317`.`ft_data`.`account_timeseries`
  
  
  OPTIONS()
  as (
    /*
A timeseries of account balances for each client binned every 4hrs.
Can definitely be tidied up - e.g. not use inline functions but need to figure out how to do this in dbt
*/



/*
Project/aggregate cashflow data into tumbled bins and project onto customer_id, datetime index
*/

    WITH event_logs AS
    (
             SELECT   * ,
                      sum(amount) OVER ( partition BY customer_id ORDER BY log_datetime rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row) AS balance
             FROM     `ft-data-330317`.`ft_data`.`account_cashflows`
             ORDER BY log_datetime ASC),

          agged_events AS
    (
             SELECT   sum(amount) delta,
                      customer_id,
                     ft_data.tumble_interval(log_datetime, 21600) tumble
             FROM     event_logs
             GROUP BY customer_id,
                      tumble
             ORDER BY customer_id,
                      tumble ASC ),
           args AS
    (
           SELECT array_agg(DISTINCT customer_id) AS KEY,
                  min(tumble)                     AS min_ts,
                  max(tumble)                     AS max_ts
           FROM   agged_events ),

           timeseries AS
    (
                    SELECT          series_key         AS customer_id,
                                    tumble_val         AS tumble,
                                    COALESCE(delta, 0) AS def,
                                    delta              AS unfilled
                    FROM            unnest(
                                    (
                                           SELECT  ft_data.timeseries_index(KEY, 21600, min_ts, max_ts)
                                           FROM   args) ) a
                    LEFT OUTER JOIN agged_events b
                    ON              a.series_key = b.customer_id
                    AND             a.tumble_val = b.tumble
                    ORDER BY        customer_id,
                                    tumble_val DESC)

    SELECT   customer_id,
             tumble                                                                                                           AS datetime,
             sum(def) OVER ( partition BY customer_id ORDER BY tumble rows BETWEEN UNBOUNDED PRECEDING AND      CURRENT row ) AS account_balance
    FROM     timeseries
    ORDER BY customer_id,
             tumble ASC
  );
    
2021-11-01 05:30:15.276856 (Thread-3): finished collecting timing info
2021-11-01 05:30:15.277926 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a513b8b2-de58-4c98-87ea-87b34a26eefb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b2bd60>]}
2021-11-01 05:30:15.278683 (Thread-3): 05:30:15 | 2 of 2 OK created table model ft_data.account_timeseries............. [CREATE TABLE (1.1m rows, 888.4 KB processed) in 6.57s]
2021-11-01 05:30:15.278984 (Thread-3): Finished running node model.freetrade_test.account_timeseries
2021-11-01 05:30:15.280852 (MainThread): Acquiring new bigquery connection "master".
2021-11-01 05:30:15.281476 (MainThread): 05:30:15 | 
2021-11-01 05:30:15.281766 (MainThread): 05:30:15 | Finished running 2 table models, 1 hook in 16.34s.
2021-11-01 05:30:15.282013 (MainThread): Connection 'master' was properly closed.
2021-11-01 05:30:15.282211 (MainThread): Connection 'model.freetrade_test.account_cashflows' was properly closed.
2021-11-01 05:30:15.282395 (MainThread): Connection 'model.freetrade_test.account_timeseries' was properly closed.
2021-11-01 05:30:15.290007 (MainThread): 
2021-11-01 05:30:15.290299 (MainThread): Completed successfully
2021-11-01 05:30:15.290534 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-11-01 05:30:15.290857 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b73700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b25430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114afe2b0>]}
2021-11-01 05:30:15.291171 (MainThread): Flushing usage events
